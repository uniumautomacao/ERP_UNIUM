# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Home Screen:
    Properties:
      Fill: =RGBA(255, 255, 255, 1)
      LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
      OnVisible: |
        =If(
            IsBlank(SpinCounter),
            UpdateContext({SpinCounter: 0}),
            Select(RefreshButton)
        );
    Children:
      - RootLayoutContainer_HS:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            DropShadow: =DropShadow.None
            Fill: =RGBA(250, 250, 250, 1)
            Height: =App.Height
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutOverflowY: =LayoutOverflow.Scroll
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Width: =App.Width
          Children:
            - CommandContainer_HS:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  DropShadow: =DropShadow.None
                  FillPortions: =0
                  Height: =44
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutMaxHeight: =
                  LayoutMaxWidth: =
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                Children:
                  - CommandBar1:
                      Control: CodeComponent
                      ComponentName: cat_PowerCAT.CommandBar
                      Properties:
                        FillPortions: =1
                        Items: |-
                          =Table(
                                  {
                                      ItemKey: "Refresh",
                                      ItemIconName: "Refresh",
                                      ItemDisplayName: "Atualizar"
                                  },
                                  {
                                      ItemKey: "New",
                                      ItemIconName: "Add",
                                      ItemDisplayName: "Novo RMA"
                                  }
                              )
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinWidth: =0
                        OnSelect: |-
                          =UpdateContext({SpinCounter: SpinCounter + 1});
                          Switch(
                              Self.Selected.ItemKey,
                              "Refresh",
                              Select(RefreshButton),
                              "New",
                              Launch(
                                  "https://unium.crm2.dynamics.com/main.aspx?appid=3ec4d8a9-2a8e-ee11-8179-002248de6f66&forceUCI=1&pagetype=entityrecord&etn=new_rma&id=" & Patch(
                                      Defaults(RMAS),
                                      {
                                          new_posicao: Min(
                                              RMASAtivos As L,
                                              L.Posição
                                          ) - 1
                                      }
                                  ).RMA,
                                  Blank(),
                                  LaunchTarget.New
                              )
                          );
                          UpdateContext({SpinCounter: SpinCounter - 1})
                        Theme: =AppThemeJson
                        Width: '=600 '
                  - RefreshButton:
                      Control: FluentV8/Button@1.5.13
                      Properties:
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        OnSelect: |-
                          =UpdateContext({SpinCounter: SpinCounter + 1});
                          Concurrent(
                              Refresh(RMAS),
                              Refresh(AppPreferences)
                          );
                          With(
                              {
                                  Value: Filter(
                                      RMAS As L,
                                      IsBlank(L.Posição)
                                  )
                              } As PosicaoVazia,
                              ForAll(
                                  PosicaoVazia.Value As Item,
                                  Patch(
                                      RMAS,
                                      {
                                          RMA: Item.RMA,
                                          Posição: RandBetween(
                                              0,
                                              1000
                                          )
                                      }
                                  )
                              )
                          );
                          UpdateContext({SpinCounter: SpinCounter - 1})
                        Visible: =false
                  - TextCanvas1:
                      Control: Text@0.0.51
                      Properties:
                        Align: ='TextCanvas.Align'.Center
                        Font: =Font.Lato
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="V2.8"
                        VerticalAlign: =VerticalAlign.Middle
            - SubheaderContainer_HS:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  FillPortions: =0
                  Height: =70
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =10
                  LayoutMaxHeight: =
                  LayoutMaxWidth: =
                  PaddingLeft: =10
                  PaddingRight: =10
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                Children:
                  - lbTitleCodeReview:
                      Control: Label@2.5.1
                      Properties:
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =RGBA(20, 0, 0, 1)
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.Lato
                        FontWeight: =FontWeight.Semibold
                        Height: =70
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        PaddingLeft: =20
                        Size: =14
                        Text: ="Quadro de RMAs"
                        Width: =240
                        Y: =241
                  - ComboboxCanvas1:
                      Control: ComboBox@0.0.51
                      Properties:
                        DefaultSelectedItems: =EstagiosSelecionados
                        InputTextPlaceholder: ="Selecione os estágios desejados"
                        Items: =Estagios
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        OnChange: |-
                          =/*Patch(
                              AppPreferences,
                              Coalesce(
                                  LookUp(
                                      AppPreferences As P,
                                      And(
                                          P.User.'Primary Email' = User().Email,
                                          P.'Preference Key' = "EstagioQuadroRMA_" & Self.Selected.Value
                                      )
                                  ),
                                  Defaults(AppPreferences)
                              ),
                              {
                                  'Preference Key': "EstagioQuadroRMA_" & Self.Selected.Value,
                                  User: LookUp(
                                      Users As U,
                                      U.'Primary Email' = User().Email
                                  ),
                                  BoolValue: If(
                                      LookUp(
                                          AppPreferences As P,
                                          And(
                                              P.User.'Primary Email' = User().Email,
                                              P.'Preference Key' = "EstagioQuadroRMA_" & Self.Selected.Value
                                          ),
                                          P.BoolValue
                                      ) = true,
                                      false,
                                      true
                                  )
                              }
                          );*/With(
                              {
                                  Value: Filter(
                                      AppPreferences As P,
                                      P.User.'Primary Email' = User().Email,
                                      StartsWith(
                                          P.'Preference Key',
                                          "EstagioQuadroRMA_"
                                      )
                                  )
                              } As Prefs,
                              Concurrent(
                                  ForAll(
                                      Self.SelectedItems As Item,
                                      With(
                                          {Value: "EstagioQuadroRMA_" & Item.Value} As Key,
                                          If(
                                              CountRows(
                                                  Filter(
                                                      AppPreferences As P,
                                                      P.User.'Primary Email' = User().Email,
                                                      P.'Preference Key' = Key.Value
                                                  )
                                              ) = 0,
                                              Patch(
                                                  AppPreferences,
                                                  Defaults(AppPreferences),
                                                  {
                                                      'Preference Key': Key.Value,
                                                      User: LookUp(
                                                          Users As U,
                                                          U.'Primary Email' = User().Email
                                                      ),
                                                      BoolValue: true
                                                  }
                                              )
                                          )
                                      )
                                  ),
                                  ForAll(
                                      Prefs.Value As P,
                                      Patch(
                                          AppPreferences,
                                          P,
                                          {
                                              BoolValue: Last(
                                                  Split(
                                                      P.'Preference Key',
                                                      "_"
                                                  )
                                              ).Value in ForAll(
                                                  Self.SelectedItems As I,
                                                  Text(I.Value)
                                              )
                                          }
                                      )
                                  )
                              )
                          )
                        SelectMultiple: =true
                  - SearchBox_1:
                      Control: CanvasComponent
                      ComponentName: SearchBox
                      Properties:
                        Height: =36
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Styles: |-
                          =Table({Name: "PrimaryColor1Value", Value: "#ffffff"},
                          {Name: "PrimaryColor1TextValue", Value: "#292929"},
                          {Name: "PrimaryColor2Value", Value: "#0078d4"},
                          {Name: "PrimaryColor2TextValue", Value: "#ffffff"},
                          {Name: "PrimaryColor3Value", Value: "#303030"},
                          {Name: "PrimaryColor3TextValue", Value: "#080808"},
                          {Name: "PrimaryColor4Value", Value: "#006e7d"},
                          {Name: "defaultLabelColorValue", Value: "#333333"},
                          {Name: "RadiusValue", Value: "0"},
                          {Name: "TextBodyFontFaceValue", Value: "Segoe UI" },
                          {Name: "PaddingValue", Value: "8"},
                          {Name: "TextEmphasisFontSizeValue", Value: "16"},
                          {Name: "TextEmphasisFontSizePhoneValue", Value: "24"},
                          {Name: "TextBodyFontSizeValue", Value: "12"},
                          {Name: "TextBodyFontSizePhoneValue", Value: "21"},
                          {Name: "BackgroundColorValue", Value: "#ffffff"},
                          {Name: "BorderThicknessValue", Value: "0"},
                          {Name: "BorderColorValue", Value: "#FFFFFF"},
                          {Name: "FocusedBorderThicknessValue", Value: "0"},
                          {Name: "BackgroundColorValue", Value :"#FFFFFF"}
                          )
                        Width: =300
            - ContentContainer_HS:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  DropShadow: =DropShadow.None
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutMaxHeight: =
                  LayoutMaxWidth: =
                  RadiusBottomLeft: =0
                  RadiusBottomRight: =0
                  RadiusTopLeft: =0
                  RadiusTopRight: =0
                Children:
                  - RMASGallery:
                      Control: Gallery@2.15.0
                      Variant: BrowseLayout_Horizontal_TwoTextOneImageVariant_pcfCore
                      Properties:
                        BorderColor: =RGBA(166, 166, 166, 1)
                        FocusedBorderColor: =RGBA(0, 120, 212, 1)
                        FocusedBorderThickness: =2
                        Items: |-
                          =/*AddColumns(
                              If(
                                  CountRows(EstagiosSelecionados) = 0,
                                  Estagios,
                                  EstagiosSelecionados
                              ) As Item,
                              Items,
                              Filter(
                                  RMASAtivos As L,
                                  L.Situação = Item.Value
                              )
                          )*/
                          If(
                              CountRows(EstagiosSelecionados) = 0,
                              Estagios,
                              EstagiosSelecionados
                          )
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinWidth: =0
                        TemplatePadding: =5
                        TemplateSize: =LaneWidth
                      Children:
                        - Rectangle1:
                            Control: Rectangle@2.3.0
                            Properties:
                              BorderColor: =ColorValue(AppTheme.palette.neutralLight)
                              BorderThickness: =1
                              DisabledFill: =RGBA(0,0,0,0)
                              Fill: =RGBA(0,0,0,0)
                              FocusedBorderColor: =RGBA(0, 120, 212, 1)
                              Height: =Parent.TemplateHeight
                              HoverFill: =RGBA(0,0,0,0)
                              OnSelect: =Select(Parent)
                              PressedFill: =RGBA(0,0,0,0)
                              TabIndex: =0
                              Visible: =false
                              Width: =Parent.TemplateWidth
                        - RMASGalleryTemplate:
                            Control: GroupContainer@1.4.0
                            Variant: AutoLayout
                            Properties:
                              Height: =Parent.TemplateHeight
                              LayoutAlignItems: =LayoutAlignItems.Stretch
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                              Width: =Parent.TemplateWidth
                            Children:
                              - RMASGalleryTitleLabel:
                                  Control: FluentV8/Label@1.8.6
                                  Properties:
                                    Alignment: =Align.Center
                                    AutoHeight: =true
                                    Font: =Font.Lato
                                    FontWeight: =FontWeight.Semibold
                                    Height: =24
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LayoutMinWidth: =0
                                    OnSelect: =
                                    TabIndex: =-1
                                    Text: |-
                                      =If(
                                          IsBlank(ThisItem.Value),
                                          "Novos",
                                          ThisItem.Value
                                      )
                                    VerticalAlignment: =VerticalAlign.Top
                                    Width: =
                                    X: =1
                                    Y: =
                              - RMASGalleryResponsavelLabel:
                                  Control: FluentV8/Label@1.8.6
                                  Properties:
                                    Alignment: =Align.Center
                                    AutoHeight: =true
                                    Font: =Font.Lato
                                    FontWeight: =FontWeight.Semibold
                                    Height: =24
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LayoutMinWidth: =0
                                    OnSelect: =
                                    TabIndex: =-1
                                    Text: |-
                                      =If(
                                          ThisItem.Value in [
                                              'RMA Stage'.'Enviar para assistência',
                                              'RMA Stage'.'Em trânsito para assistência',
                                              'RMA Stage'.'Em análise',
                                              'RMA Stage'.'Em reparo',
                                              'RMA Stage'.'Em trânsito de retorno'
                                          ],
                                          "Adm",
                                          If(
                                              ThisItem.Value in [
                                                  'RMA Stage'.'Em avaliação interna',
                                                  'RMA Stage'.'Recebido da assistência'
                                              ],
                                              "Estoquista",
                                              "CS"
                                          )
                                      )
                                    VerticalAlignment: =VerticalAlign.Top
                                    Width: =
                                    X: =1
                                    Y: =
                              - LaneSubtitleContainer:
                                  Control: GroupContainer@1.4.0
                                  Variant: AutoLayout
                                  Properties:
                                    DropShadow: =DropShadow.None
                                    Fill: =RGBA(0,0,0,0)
                                    FillPortions: =0
                                    Height: =29
                                    LayoutAlignItems: =LayoutAlignItems.Stretch
                                    LayoutDirection: =LayoutDirection.Horizontal
                                    LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LayoutMinHeight: =29
                                    LayoutMinWidth: =0
                                    PaddingLeft: =10
                                    PaddingRight: =10
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                  Children:
                                    - LaneCounterLabel:
                                        Control: FluentV8/Label@1.8.6
                                        Properties:
                                          Alignment: =Align.Left
                                          Color: =ColorValue(AppTheme.palette.neutralSecondary)
                                          FillPortions: =1
                                          Font: =Font.Lato
                                          LayoutMaxHeight: =
                                          LayoutMaxWidth: =
                                          LayoutMinHeight: =0
                                          LayoutMinWidth: =0
                                          Text: |-
                                            =With(
                                                {
                                                    Value: CountRows(
                                                        Filter(
                                                            RMASAtivos As L,
                                                            L.Situação = ThisItem.Value
                                                        )
                                                    )
                                                } As C,
                                                If(
                                                    C.Value = 1,
                                                    "1 negócio",
                                                    C.Value & " itens"
                                                )
                                            )
                                          Width: =
                              - RMASLaneGallery:
                                  Control: Gallery@2.15.0
                                  Variant: BrowseLayout_Flexible_NewsFeed_pcfCore
                                  Properties:
                                    BorderColor: =RGBA(166, 166, 166, 1)
                                    DelayItemLoading: =true
                                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                    FocusedBorderThickness: =2
                                    Items: |-
                                      =With(
                                          {
                                              Value: Search(
                                                  Filter(
                                                      RMASAtivos As L,
                                                      L.Situação = ThisItem.Value
                                                  ),
                                                  SearchBox_1.SearchText,
                                                  'Assistência Técnica',
                                                  Descrição,
                                                  Observações,
                                                  'Nome do Cliente (Fx)',
                                                  'Projeto (Apelido) (Fx)',
                                                  'Código de Rastreio da Transportadora',
                                                  Observações
                                              )
                                          } As Items,
                                          If(
                                              ThisItem.Value = 'RMA Stage'.Devolvido,
                                              SortByColumns(
                                                  FirstN(
                                                      SortByColumns(
                                                          Items.Value,
                                                          "modifiedon",
                                                          SortOrder.Descending
                                                      ),
                                                      50
                                                  ),
                                                  "new_lembreteexpirado",
                                                  SortOrder.Descending,
                                                  "new_posicao",
                                                  SortOrder.Ascending
                                              ),
                                              Items.Value
                                          )
                                      )
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LoadingSpinner: =LoadingSpinner.Data
                                    OnSelect: =
                                    TemplatePadding: =5
                                    TemplateSize: =100
                                  Children:
                                    - Separator1:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =RGBA(0, 0, 0, 0)
                                          Fill: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                                          Height: =1
                                          OnSelect: =Select(Parent)
                                          Visible: =false
                                          Width: =Parent.TemplateWidth
                                          Y: =RMASLaneTemplateContainer.Y+RMASLaneTemplateContainer.Height
                                    - RMASubtitleLabel_1:
                                        Control: Label@2.5.1
                                        Properties:
                                          Align: =Align.Center
                                          AutoHeight: =true
                                          BorderColor: =RGBA(0, 0, 0, 0)
                                          BorderStyle: =BorderStyle.None
                                          BorderThickness: =2
                                          Color: =RGBA(51, 51, 51, 1)
                                          DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                          FocusedBorderThickness: =2
                                          Font: =Font.Lato
                                          Height: =
                                          OnSelect: =
                                          PaddingBottom: =0
                                          PaddingLeft: =0
                                          PaddingRight: =0
                                          PaddingTop: =0
                                          Size: =10.5
                                          Text: ="R$ 0,00"
                                          VerticalAlign: =VerticalAlign.Top
                                          Width: =
                                          X: =20
                                          Y: =40
                                    - RMASLaneTemplateRectangle:
                                        Control: Rectangle@2.3.0
                                        Properties:
                                          BorderColor: =RGBA(255, 0, 0, 1)
                                          BorderStyle: =
                                          BorderThickness: =1
                                          DisabledFill: =RGBA(166, 166, 166, 1)
                                          Fill: =RGBA(0, 0, 0, 0)
                                          FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                          Height: =RMASLaneTemplateContainer.Height
                                          HoverFill: =RGBA(0, 0, 0, 0.1)
                                          OnSelect: |
                                            =Patch(
                                                AppPreferences,
                                                Defaults(AppPreferences),
                                                {
                                                    User: CurrentUser,
                                                    'Preference Key': "CadastroMercadoriaRMA_" & Now(),
                                                    StringValue: ThisItem.RMA
                                                }
                                            );
                                            Launch(
                                                //"https://unium.crm2.dynamics.com/main.aspx?appid=3ec4d8a9-2a8e-ee11-8179-002248de6f66&forceUCI=1&pagetype=entityrecord&etn=new_rma&id=" & ThisItem.RMA,
                                                "https://unium.crm2.dynamics.com/main.aspx?appid=090088ff-5c8d-ee11-8179-002248de672c&pagetype=custom&name=new_cadastroderetornodemercadoriapage_754dc",//"https://unium.crm2.dynamics.com/main.aspx?pagetype=custom&name=new_cadastroderetornodemercadoriapage_754dc",
                                                Blank(),
                                                LaunchTarget.New
                                            );
                                          PressedFill: =RGBA(255, 255, 255, 0.1)
                                          Width: =RMASLaneTemplateContainer.Width
                                    - RMASLaneTemplateContainer:
                                        Control: GroupContainer@1.4.0
                                        Variant: AutoLayout
                                        Properties:
                                          BorderColor: =Color.Red
                                          BorderStyle: |-
                                            =If(
                                                Or(
                                                    ThisItem.Sinalizar = true,
                                                    And(
                                                        ThisItem.'Data do Lembrete' < Now(),
                                                        !IsBlank(ThisItem.'Data do Lembrete')
                                                    )
                                                ),
                                                BorderStyle.Dotted,
                                                BorderStyle.None
                                            )
                                          BorderThickness: =1
                                          DropShadow: =DropShadow.Semilight
                                          Height: |-
                                            =RMATitleLabel.Height + RMASubtitleContainer.Height + If(
                                                RMABodyLabel.Visible,
                                                RMABodyLabel.Height + Self.LayoutGap
                                            ) + RMATitleLabel.Height + If(
                                                RMALembreteLabel.Visible,
                                                RMALembreteLabel.Height + Self.LayoutGap
                                            ) + SituacaoContainer.Height + ClienteInformadoCheckbox.Height + Self.LayoutGap * 6
                                          LayoutAlignItems: =LayoutAlignItems.Stretch
                                          LayoutDirection: =LayoutDirection.Vertical
                                          LayoutGap: =5
                                          LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                          PaddingBottom: =10
                                          PaddingLeft: =10
                                          PaddingRight: =10
                                          PaddingTop: =10
                                          Width: =LaneWidth-Parent.TemplatePadding*2
                                        Children:
                                          - RMATitleLabel:
                                              Control: Label@2.5.1
                                              Properties:
                                                AutoHeight: =true
                                                BorderColor: =RGBA(0, 0, 0, 0)
                                                BorderStyle: =BorderStyle.None
                                                BorderThickness: =2
                                                Color: =RGBA(51, 51, 51, 1)
                                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                                FocusedBorderThickness: =2
                                                Font: =Font.Lato
                                                FontWeight: =FontWeight.Semibold
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                LayoutMinHeight: =0
                                                LayoutMinWidth: =0
                                                OnSelect: =Select(RMASLaneTemplateRectangle)
                                                PaddingBottom: =0
                                                PaddingLeft: =0
                                                PaddingRight: =0
                                                PaddingTop: =0
                                                Size: =10.5
                                                Text: |-
                                                  =ThisItem.Id & ": " & LookUp(
                                                      RMAS As R,
                                                      R.RMA = ThisItem.RMA,
                                                      Coalesce(
                                                          R.Cliente.'Full Name',
                                                          R.'Ordem de Serviço'.'Projeto (Apelido)',
                                                          R.'Ordem de Serviço'.'Nome do Cliente (Fx)',
                                                          R.'Ordem de Serviço'.Name
                                                      )
                                                  )
                                                VerticalAlign: =VerticalAlign.Top
                                                Width: =
                                                X: =12
                                                Y: =6
                                          - RMASubtitleContainer:
                                              Control: GroupContainer@1.4.0
                                              Variant: AutoLayout
                                              Properties:
                                                DropShadow: =DropShadow.None
                                                FillPortions: =0
                                                Height: =Max(InfoContainer.Height,40)
                                                LayoutAlignItems: =LayoutAlignItems.Stretch
                                                LayoutDirection: =LayoutDirection.Horizontal
                                                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                LayoutMinWidth: =0
                                              Children:
                                                - PosicaoContainer_1:
                                                    Control: GroupContainer@1.4.0
                                                    Variant: AutoLayout
                                                    Properties:
                                                      AlignInContainer: =AlignInContainer.SetByContainer
                                                      DropShadow: =DropShadow.None
                                                      FillPortions: =0
                                                      Height: =40
                                                      LayoutAlignItems: =LayoutAlignItems.End
                                                      LayoutDirection: =LayoutDirection.Vertical
                                                      LayoutJustifyContent: =LayoutJustifyContent.Center
                                                      LayoutMaxHeight: =
                                                      LayoutMaxWidth: =
                                                      LayoutMinHeight: =0
                                                      LayoutMinWidth: =0
                                                      Width: =30
                                                    Children:
                                                      - PosicaoUpButton_1:
                                                          Control: Button@0.0.45
                                                          Properties:
                                                            Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                            FillPortions: =1
                                                            Icon: ="ChevronUp"
                                                            Layout: ='ButtonCanvas.Layout'.IconOnly
                                                            LayoutMaxHeight: =
                                                            LayoutMaxWidth: =
                                                            LayoutMinHeight: =0
                                                            OnSelect: |-
                                                              =// Definir a variável global para armazenar a lista atual ordenada corretamente
                                                              UpdateContext({SpinCounter:SpinCounter+1});
                                                              Set(
                                                                  colItensOrdenados,
                                                                  ShowColumns(
                                                                      Filter(
                                                                          RMASAtivos As L,
                                                                          L.Situação = ThisItem.Situação
                                                                      ),
                                                                      Posição,
                                                                      RMA
                                                                  )
                                                              );
                                                              // Encontrar o índice do item na lista ordenada
                                                              Set(
                                                                  indexItem,
                                                                  LookUp(
                                                                      ForAll(
                                                                          Sequence(CountRows(colItensOrdenados)),
                                                                          {
                                                                              Index: Value,
                                                                              ID: Last(
                                                                                  FirstN(
                                                                                      colItensOrdenados,
                                                                                      Value
                                                                                  )
                                                                              ).new_rmaid
                                                                          }
                                                                      ),
                                                                      ID = ThisItem.RMA
                                                                  ).Index
                                                              );
                                                              // Se o item estiver no topo, não faz nada
                                                              If(
                                                                  indexItem = 1,
                                                                  Notify(
                                                                      "Este item já está no topo.",
                                                                      NotificationType.Warning
                                                                  ),
                                                                  With(
                                                                      {
                                                                          itemAtual: LookUp(
                                                                              colItensOrdenados,
                                                                              new_rmaid = ThisItem.RMA
                                                                          ),
                                                                          itemAnterior: Last(
                                                                              FirstN(
                                                                                  colItensOrdenados,
                                                                                  indexItem - 1
                                                                              )
                                                                          )
                                                                      },
                                                                      Concurrent(
                                                                          Patch(
                                                                              RMAS,
                                                                              itemAtual,
                                                                              {Posição: itemAnterior.new_posicao}
                                                                          ),
                                                                          Patch(
                                                                              RMAS,
                                                                              itemAnterior,
                                                                              {Posição: itemAtual.new_posicao}
                                                                          )
                                                                      )
                                                                  )
                                                              );
                                                              Select(RefreshButton);
                                                              UpdateContext({SpinCounter:SpinCounter-1})
                                                            Text: ="Up"
                                                            Width: =40
                                                      - PosicaoDownButton_1:
                                                          Control: Button@0.0.45
                                                          Properties:
                                                            Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                            FillPortions: =1
                                                            Icon: ="ChevronDown"
                                                            Layout: ='ButtonCanvas.Layout'.IconOnly
                                                            LayoutMaxHeight: =
                                                            LayoutMaxWidth: =
                                                            LayoutMinHeight: =0
                                                            OnSelect: |-
                                                              =UpdateContext({SpinCounter:SpinCounter+1});
                                                              // Definir a variável global para armazenar a lista atual ordenada corretamente
                                                              Set(
                                                                  colItensOrdenados,
                                                                  ShowColumns(
                                                                      Filter(
                                                                          RMASAtivos As L,
                                                                          L.Situação = ThisItem.Situação
                                                                      ),
                                                                      Posição,
                                                                      RMA
                                                                  )
                                                              );
                                                              // Encontrar o índice do item na lista ordenada
                                                              Set(
                                                                  indexItem,
                                                                  LookUp(
                                                                      ForAll(
                                                                          Sequence(CountRows(colItensOrdenados)),
                                                                          {
                                                                              Index: Value,
                                                                              ID: Last(
                                                                                  FirstN(
                                                                                      colItensOrdenados,
                                                                                      Value
                                                                                  )
                                                                              ).new_rmaid
                                                                          }
                                                                      ),
                                                                      ID = ThisItem.RMA
                                                                  ).Index
                                                              );
                                                              // Se o item já estiver na última posição, não faz nada
                                                              If(
                                                                  indexItem = CountRows(colItensOrdenados),
                                                                  Notify(
                                                                      "Este item já está na última posição.",
                                                                      NotificationType.Warning
                                                                  ),
                                                                  With(
                                                                      {
                                                                          itemAtual: LookUp(
                                                                              colItensOrdenados,
                                                                              new_rmaid = ThisItem.RMA
                                                                          ),
                                                                          itemProximo: Last(
                                                                              FirstN(
                                                                                  colItensOrdenados,
                                                                                  indexItem + 1
                                                                              )
                                                                          )
                                                                      },
                                                                      Concurrent(
                                                                          Patch(
                                                                              RMAS,
                                                                              itemAtual,
                                                                              {Posição: itemProximo.new_posicao}
                                                                          ),
                                                                          Patch(
                                                                              RMAS,
                                                                              itemProximo,
                                                                              {Posição: itemAtual.new_posicao}
                                                                          )
                                                                      )
                                                                  )
                                                              );
                                                              Select(RefreshButton);
                                                              UpdateContext({SpinCounter:SpinCounter-1})
                                                              /*
                                                              Patch(RMAS,
                                                                              itemAtual, 
                                                                              { new_posicao: itemProximo.Posição }
                                                                          );
                                                                          Patch(RMAS,
                                                                              itemProximo, 
                                                                              { new_posicao: Items.itemAtual.Posição }
                                                                          )
                                                              */
                                                            Text: ="Down"
                                                            Width: =40
                                                      - ExpandButton:
                                                          Control: Button@0.0.45
                                                          Properties:
                                                            Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                            FillPortions: =1
                                                            Icon: ="Info"
                                                            Layout: ='ButtonCanvas.Layout'.IconOnly
                                                            LayoutMaxHeight: =
                                                            LayoutMaxWidth: =
                                                            LayoutMinHeight: =0
                                                            OnSelect: |-
                                                              =UpdateContext(
                                                                  {
                                                                      ItemToExpand: If(
                                                                          ItemToExpand = ThisItem.RMA,
                                                                          Blank(),
                                                                          ThisItem.RMA
                                                                      )
                                                                  }
                                                              )
                                                            Text: ="Expand"
                                                            Visible: |-
                                                              =If(
                                                                  (Len(ThisItem.Descrição) + Len(ThisItem.Observações)) > 60,
                                                                  true,
                                                                  false
                                                              )
                                                            Width: =40
                                                - InfoContainer:
                                                    Control: GroupContainer@1.4.0
                                                    Variant: AutoLayout
                                                    Properties:
                                                      AlignInContainer: =AlignInContainer.Center
                                                      DropShadow: =DropShadow.None
                                                      Height: =If(RMAValueLabel.Visible,RMAValueLabel.Height)
                                                      LayoutAlignItems: =LayoutAlignItems.Stretch
                                                      LayoutDirection: =LayoutDirection.Vertical
                                                      LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                                      LayoutMaxHeight: =
                                                      LayoutMaxWidth: =
                                                      LayoutMinHeight: =0
                                                      LayoutMinWidth: =0
                                                      LayoutWrap: =true
                                                    Children:
                                                      - RMAValueLabel:
                                                          Control: Label@2.5.1
                                                          Properties:
                                                            AlignInContainer: =AlignInContainer.Stretch
                                                            AutoHeight: =true
                                                            BorderColor: =RGBA(0, 0, 0, 0)
                                                            BorderStyle: =BorderStyle.None
                                                            BorderThickness: =2
                                                            Color: =RGBA(51, 51, 51, 1)
                                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                                            FocusedBorderThickness: =2
                                                            Font: =Font.Lato
                                                            Height: =0
                                                            LayoutMaxHeight: =
                                                            LayoutMaxWidth: =
                                                            LayoutMinWidth: =0
                                                            OnSelect: =Select(RMASLaneTemplateRectangle)
                                                            PaddingBottom: =0
                                                            PaddingLeft: =0
                                                            PaddingRight: =0
                                                            PaddingTop: =0
                                                            Size: =9
                                                            Text: "=With(\n    {\n        Value: ThisItem.Descrição & If(\n            Len(TrimEnds(ThisItem.Observações)) > 0,\n            \"\n    \n\" & ThisItem.Observações\n        )\n    } As T,\n    If(\n        Len(T.Value) <= 60,\n        T.Value,\n        If(\n            ItemToExpand = ThisItem.RMA,\n            T.Value,\n            Left(\n                T.Value,\n                60\n            ) & \"...\"\n        )\n    )\n)"
                                                            VerticalAlign: =VerticalAlign.Top
                                                            Width: =
                                                            X: =12
                                                            Y: =6
                                          - RMABodyLabel:
                                              Control: Label@2.5.1
                                              Properties:
                                                AutoHeight: =true
                                                BorderColor: =RGBA(0, 0, 0, 0)
                                                BorderStyle: =BorderStyle.None
                                                BorderThickness: =2
                                                Color: =RGBA(51, 51, 51, 1)
                                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                                FocusedBorderThickness: =2
                                                Font: =Font.Lato
                                                FontWeight: =FontWeight.Lighter
                                                Height: =
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                LayoutMinWidth: =0
                                                OnSelect: =
                                                PaddingBottom: =0
                                                PaddingLeft: =0
                                                PaddingRight: =0
                                                PaddingTop: =0
                                                Size: =8
                                                Text: |-
                                                  =Concatenate(
                                                      LookUp(
                                                          RMAS As R,
                                                          R.RMA = ThisItem.RMA,
                                                          R.'Tipo de RMA'
                                                      ),
                                                      ": ",
                                                      Concat(
                                                          Distinct(
                                                              Filter(
                                                                  'Estoque-RMAS' As E,
                                                                  E.'Estoque-RMA' in Distinct(
                                                                      ThisItem.'Estoque-RMAS' As I,
                                                                      I.'Estoque-RMA'
                                                                  )
                                                              ) As Item,
                                                              Item.Produto.'Referência do Produto'
                                                          ) As Item,
                                                          Item.Value,
                                                          ", "
                                                      )
                                                  )
                                                VerticalAlign: =VerticalAlign.Top
                                                Visible: =Len(Self.Text) > 0
                                                Width: =
                                                X: =12
                                                Y: =6
                                          - RMALembreteLabel:
                                              Control: Label@2.5.1
                                              Properties:
                                                AutoHeight: =true
                                                BorderColor: =RGBA(0, 0, 0, 0)
                                                BorderStyle: =BorderStyle.None
                                                BorderThickness: =2
                                                Color: =RGBA(51, 51, 51, 1)
                                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                                FocusedBorderThickness: =2
                                                Font: =Font.Lato
                                                FontWeight: =FontWeight.Lighter
                                                Height: =
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                LayoutMinWidth: =0
                                                OnSelect: =
                                                PaddingBottom: =0
                                                PaddingLeft: =0
                                                PaddingRight: =0
                                                PaddingTop: =0
                                                Size: =8
                                                Text: |-
                                                  ="Data Lembrete: " & Text(ThisItem.'Data do Lembrete',DateTimeFormat.ShortDate,"pt-BR")
                                                VerticalAlign: =VerticalAlign.Top
                                                Visible: =!IsBlank(ThisItem.'Data do Lembrete')
                                                Width: =
                                                X: =12
                                                Y: =6
                                          - SituacaoContainer:
                                              Control: GroupContainer@1.4.0
                                              Variant: AutoLayout
                                              Properties:
                                                AlignInContainer: =AlignInContainer.SetByContainer
                                                DropShadow: =DropShadow.None
                                                FillPortions: =0
                                                Height: =20
                                                LayoutAlignItems: =LayoutAlignItems.Stretch
                                                LayoutDirection: =LayoutDirection.Horizontal
                                                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                LayoutMinHeight: =0
                                                LayoutMinWidth: =0
                                                Width: =30
                                              Children:
                                                - SituacaoLeftButton:
                                                    Control: Button@0.0.45
                                                    Properties:
                                                      Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                      DisplayMode: |-
                                                        =If(
                                                            Or(
                                                                ThisItem.Situação = Blank(),
                                                                ThisItem.Situação = Min(
                                                                    Choices('RMA Stage') As S,
                                                                    S.Value
                                                                )
                                                            ),
                                                            DisplayMode.Disabled,
                                                            DisplayMode.Edit
                                                        )
                                                      FillPortions: =1
                                                      Icon: ="ChevronLeft"
                                                      Layout: ='ButtonCanvas.Layout'.IconOnly
                                                      LayoutMaxHeight: =
                                                      LayoutMaxWidth: =
                                                      LayoutMinHeight: =0
                                                      LayoutMinWidth: =0
                                                      OnSelect: |-
                                                        =UpdateContext({SpinCounter: SpinCounter + 1});
                                                        With(
                                                            {
                                                                Value: Filter(
                                                                    Estagios As R,
                                                                    R.Value < ThisItem.Situação
                                                                )
                                                            } As Estagios,
                                                            With(
                                                                LookUp(
                                                                    Choices('RMA Stage') As S,
                                                                    S.Value = Max(
                                                                        Estagios.Value As E,
                                                                        E.Value
                                                                    )
                                                                ) As EstagioAnterior,
                                                                Patch(
                                                                    RMAS,
                                                                    {
                                                                        RMA: ThisItem.RMA,
                                                                        Situação: EstagioAnterior.Value
                                                                    }
                                                                )
                                                            )
                                                        );
                                                        UpdateContext({SpinCounter: SpinCounter - 1})
                                                      Text: ="Left"
                                                      Width: =40
                                                - PosicaoRightButton:
                                                    Control: Button@0.0.45
                                                    Properties:
                                                      Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                      DisplayMode: =If(ThisItem.Situação = Max(Choices('RMA Stage') As S, S.Value),DisplayMode.Disabled,DisplayMode.Edit)
                                                      FillPortions: =1
                                                      Icon: ="ChevronRight"
                                                      Layout: ='ButtonCanvas.Layout'.IconOnly
                                                      LayoutMaxHeight: =
                                                      LayoutMaxWidth: =
                                                      LayoutMinHeight: =0
                                                      LayoutMinWidth: =0
                                                      OnSelect: |-
                                                        =UpdateContext({SpinCounter: SpinCounter + 1});
                                                        With(
                                                            {
                                                                Value: Filter(
                                                                    Estagios As R,
                                                                    R.Value > ThisItem.Situação
                                                                )
                                                            } As Estagios,
                                                            With(
                                                                LookUp(
                                                                    Choices('RMA Stage') As S,
                                                                    S.Value = Min(
                                                                        Estagios.Value As E,
                                                                        E.Value
                                                                    )
                                                                ) As ProximoEstagio,
                                                                Patch(
                                                                    RMAS,
                                                                    {
                                                                        RMA: ThisItem.RMA,
                                                                        Situação: ProximoEstagio.Value
                                                                    }
                                                                )
                                                            )
                                                        );
                                                        UpdateContext({SpinCounter: SpinCounter - 1})
                                                      Text: ="Down"
                                                      Width: =40
                                          - ClienteInformadoCheckbox:
                                              Control: CheckBox@0.0.30
                                              Properties:
                                                Checked: |-
                                                  =LookUp(
                                                      RMAS As R,
                                                      R.RMA = ThisItem.RMA,
                                                      R.'Cliente Informado Sobre Estágio Atual'
                                                  )
                                                Label: ="Cliente Informado"
                                                LayoutMaxHeight: =
                                                LayoutMaxWidth: =
                                                OnCheck: |-
                                                  =Patch(
                                                      RMAS,
                                                      {
                                                          RMA: ThisItem.RMA,
                                                          'Último Estágio Informado ao Cliente': ThisItem.Situação
                                                      }
                                                  )
                                                OnUncheck: |-
                                                  =Patch(
                                                      RMAS,
                                                      {
                                                          RMA: ThisItem.RMA,
                                                          'Último Estágio Informado ao Cliente': Blank()
                                                      }
                                                  )
      - Spinner1:
          Control: CodeComponent
          ComponentName: cat_PowerCAT.Spinner
          Properties:
            BackgroundColor: ="#00000050"
            Height: =Parent.Height
            Label: ="Carregando..."
            SpinnerSize: ='PowerCAT.Spinner.SpinnerSize'.Large
            Theme: =AppThemeJson
            Visible: =SpinCounter > 0
            Width: =Parent.Width
