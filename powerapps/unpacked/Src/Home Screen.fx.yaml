"'Home Screen' As screen":
    Fill: |-
        =RGBA(
            255,
            255,
            255,
            1
        )
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |-
        =If(
            IsBlank(SpinCounter),
            UpdateContext({SpinCounter: 0})
        )

    RootLayoutContainer_HS As groupContainer.verticalAutoLayoutContainer:
        Fill: =RGBA(250, 250, 250, 1)
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =10
        LayoutGridColumns: =6
        LayoutGridRows: =6
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        PaddingBottom: =0.00
        PaddingLeft: =0.00
        PaddingRight: =0.00
        PaddingTop: =0.00
        Width: =Parent.Width
        X: =0.00
        Y: =0.00
        ZIndex: =1

        CommandContainer_HS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =28.86
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =0.00
            PaddingLeft: =0.00
            PaddingRight: =0.00
            PaddingTop: =0.00
            Width: =1095.04
            X: =0.00
            Y: =0.00
            ZIndex: =1

            "CommandBar1 As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =131.19
                Items: |-
                    =Table(
                        {
                            ItemKey: "Close",
                            ItemIconName: "ChromeClose",
                            ItemDisplayName: "Fechar Guia"
                        },
                        {
                            ItemKey: "NewDevice",
                            ItemIconName: "Add",
                            ItemDisplayName: "Novo Equipamento"
                        },
                        {
                            ItemKey: "Plot",
                            ItemIconName: "PDF",
                            ItemDisplayName: "Plotar"
                        },
                        {
                            ItemKey: "Report",
                            ItemIconName: "PDF",
                            ItemDisplayName: "Relatório"
                        },
                        {
                            ItemKey: "PrintAllTags",
                            ItemIconName: "Print",
                            ItemDisplayName: "Imprimir Etiquetas Equipamentos " & SelectedDeviceTab.DisplayName
                        },
                        {
                            ItemKey: "PrintAllConTags",
                            ItemIconName: "Print",
                            ItemDisplayName: "Imprimir Etiquetas Conexões " & SelectedDeviceTab.DisplayName,
                            ItemEnabled: GroupByDropdownSelectedOption = GroupByConTypeDropdownOption
                        },
                        {
                            ItemKey: "CSVTags",
                            ItemIconName: "Tag",
                            ItemDisplayName: "Gerar Etiquetas (CSV)"
                        },
                        {
                            ItemKey: "Diagram",
                            ItemIconName: "VisioDiagram",
                            ItemDisplayName: "Gerar Diagrama"
                        },
                        {
                            ItemKey: "Concluir",
                            ItemIconName: "Accept",
                            ItemDisplayName: "Marcar guia como concluído"
                        }
                    )
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                OnSelect: |-
                    =UpdateContext({SpinCounter: SpinCounter + 1});
                    Switch(
                        Self.Selected.ItemKey,
                        "NewDevice",
                        UpdateContext({ShowAddNewDeviceWindow: true}),
                        "Close",
                        Set(
                            CurrentProjeto,
                            Blank()
                        ),
                        "Report",
                        Navigate(
                            ReportScreen,
                            ScreenTransition.Cover,
                            {
                                InputDevices: Filter(
                                    ConnectionsReport As Con,
                                    Con.new_deviceid in Distinct(
                                        VisibleDevicesList As D,
                                        D.DeviceIO
                                    )
                                )
                            }
                        ),
                        "Plot",
                        Select(PlotButton),
                        "Tags",
                        ForAll(
                            VisibleDevicesList As Dev,
                            Patch(
                                'Impressão de Etiquetas',
                                Defaults('Impressão de Etiquetas'),
                                {
                                    'Nome do Projeto': CurrentProjeto.Apelido,
                                    Texto: Dev.Name
                                }
                            );
                            ForAll(
                                Filter(
                                    'Device IO Connections' As Con,
                                    Con.Device.DeviceIO = Dev.DeviceIO,
                                    Con.Status = 'Status (Device IO Connections)'.Active
                                ) As Con,
                                If(
                                    Or(
                                        !IsBlank(Con.'Connected To'),
                                        !IsBlank(Con.'Connected To (Manual)'),
                                        Len(Con.'Connected To (Manual)') > 0
                                    ),
                                    Patch(
                                        'Impressão de Etiquetas',
                                        Defaults('Impressão de Etiquetas'),
                                        {
                                            'Nome do Projeto': CurrentProjeto.Apelido,
                                            Texto: Con.Device.Name & " - " & Con.Name,
                                            'Texto B': If(
                                                IsBlank(Con.'Connected To'),
                                                Con.'Connected To (Manual)',
                                                Con.'Connected To'.Device.Name & " - " & Con.'Connected To'.Name & " | " & Con.'Connected To'.Localização
                                            )
                                        }
                                    )
                                )
                            )
                        ),
                        "Diagram",
                        Select(GenerateGraphButton);
                        UpdateContext({ShowDiagramText: true}),
                        "CSVTags",
                        Select(GenerateCSVButtonCanvas),
                        "Concluir",
                        Patch(
                            Projetos,
                            {
                                Projeto: CurrentProjeto.Projeto,
                                'Data de Conclusão do Guia de Conexões': Now()
                            }
                        ),
                        "PrintAllTags",
                        UpdateContext({SpinCounter: SpinCounter + 1});
                        ForAll(
                            DevicesGallery.AllItems As Device,
                            With(
                                LookUp(
                                    'Device IO' As D,
                                    D.DeviceIO = Device.DeviceIO
                                ) As Device,
                                '(ImpressãodeEtiqueta)-Imprimiretiquetadeequipamento'.Run(
                                    Device.Name,
                                    Device.Localização
                                )
                            )
                        );
                        UpdateContext({SpinCounter: SpinCounter - 1}),
                        "PrintAllConTags",
                        UpdateContext({SpinCounter: SpinCounter + 1});
                        ForAll(
                            DevicesGallery.AllItems As Device,
                            With(
                                {
                                    Value: SortByColumns(
                                        Filter(
                                            'Device IO Connections' As C,
                                            C.Device.DeviceIO = Device.DeviceIO,
                                            C.'Tipo de Conexão' = SelectedDeviceTab.Option2
                                        ),
                                        "new_tipodeconexao",
                                        SortOrder.Ascending,
                                        "new_name",
                                        SortOrder.Ascending
                                    )
                                } As Cons,
                                Notify(
                                    CountRows(
                                        Filter(
                                            Cons.Value As C,
                                            Or(
                                                !IsBlank(C.'Connected To'.'Device IO Connection'),
                                                Len(TrimEnds(C.'Connected To (Manual)')) > 0
                                            )
                                        )
                                    )
                                );
                                ForAll(
                                    Filter(
                                        Cons.Value As C,
                                        Or(
                                            !IsBlank(C.'Connected To'),
                                            Len(TrimEnds(C.'Connected To (Manual)')) > 0
                                        )
                                    ) As Con,
                                    '(ImpressãodeEtiqueta)-Imprimiretiquetadecabo'.Run(
                                        Con.Device.Name & " - " & Con.Name,
                                        If(
                                            IsBlank(Con.'Connected To'),
                                            Con.'Connected To (Manual)',
                                            If(
                                                And(
                                                    Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                                    Con.Direção = 'Direção de Conexão'.Input
                                                ),
                                                With(
                                                    LookUp(
                                                        ConsCol As ColCon,
                                                        ColCon.new_deviceioconnectionid = Con.'Device IO Connection'
                                                    ) As IndexedConInfo,
                                                    LookUp(
                                                        'Device IO Connections' As RootCon,
                                                        RootCon.'Device IO Connection' = IndexedConInfo.local_rootcon,
                                                        RootCon.Device.Name & " - " & RootCon.Name & " | " & RootCon.Localização
                                                    )
                                                ),
                                                If(
                                                    And(
                                                        Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                                        Con.Direção = 'Direção de Conexão'.Output,
                                                        Con.'Device IO Connection' in Distinct(
                                                            ConsCol As ColCon,
                                                            ColCon.local_rootcon
                                                        )
                                                    ),
                                                    With(
                                                        {
                                                            Value: Distinct(
                                                                Filter(
                                                                    ConsCol As ColCon,
                                                                    ColCon.local_rootcon = Con.'Device IO Connection',
                                                                    ColCon.new_deviceioconnectionid <> Con.'Device IO Connection'
                                                                )As Nei,
                                                                Nei.new_deviceioconnectionid
                                                            )
                                                        } As NeighborConsIds,
                                                        Concat(
                                                            Filter(
                                                                'Device IO Connections' As Con,
                                                                Con.'Device IO Connection' in NeighborConsIds.Value
                                                            ) As Con,
                                                            Con.Device.Name,
                                                            "+"
                                                        )
                                                    ),
                                                    LookUp(
                                                        'Device IO Connections' As Con2,
                                                        Con2.'Device IO Connection' = Con.'Device IO Connection',
                                                        Con2.'Connected To'.Device.Name & " - " & Con2.'Connected To'.Name & " | " & Con2.'Connected To'.Localização
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        );
                        UpdateContext({SpinCounter: SpinCounter - 1})
                    );
                    UpdateContext({SpinCounter: SpinCounter - 1})
                    /**/
                Theme: =AppThemeJson
                Width: =480.99
                X: =0.00
                Y: =-51.16
                ZIndex: =1

            VersionText As Text:
                Align: ='TextCanvas.Align'.Center
                BorderColor: =
                DisplayMode: =DisplayMode.Edit
                Fill: =
                FontColor: =
                Height: =32
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =96
                Text: ="V1.27"
                VerticalAlign: =VerticalAlign.Middle
                Width: =40
                X: =0
                Y: =0
                ZIndex: =2

        SubheaderContainer_HS As groupContainer.horizontalAutoLayoutContainer:
            FillPortions: =0
            Height: =45.92
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =0.00
            PaddingLeft: =6.56
            PaddingRight: =8.02
            PaddingTop: =0.00
            Width: =1095.04
            X: =0.00
            Y: =28.86
            ZIndex: =2

            lbTitleCodeReview As label:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(20, 0, 0, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FillPortions: =1
                FocusedBorderThickness: =4
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =45.92
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                PaddingBottom: =3.28
                PaddingLeft: =13.12
                PaddingRight: =4.01
                PaddingTop: =4.01
                Size: |
                    =12
                Text: ="Guia de Conexões"
                Width: =838.52
                X: =8.02
                Y: =0.00
                ZIndex: =1

            lbTitleCodeReview_1 As label:
                Align: =Align.Right
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(20, 0, 0, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FillPortions: =1
                FocusedBorderThickness: =4
                Font: =Font.Lato
                FontWeight: =FontWeight.Lighter
                Height: =45.92
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                PaddingBottom: =3.28
                PaddingLeft: =13.12
                PaddingRight: =4.01
                PaddingTop: =4.01
                Size: =9
                Text: =CurrentProjeto.Apelido
                Width: =838.52
                X: =8.02
                Y: =0.00
                ZIndex: =2

        ContentContainer_HS As groupContainer.verticalAutoLayoutContainer:
            Height: =428.98
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            Width: =1095.04
            X: =0.00
            Y: =74.78
            ZIndex: =3

            SearchBox_1 As SearchBox:
                Height: =30
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =640
                LayoutMinWidth: =0
                ZIndex: =1

            GroupByDropdownCanvas As Dropdown.pcfdataset:
                DefaultSelectedItems: =[GroupByDefaultDropdownOption]
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Items: |-
                    =[
                        GroupByTypeDropdownOption,
                        GroupByLocalDropdownOption,
                        GroupByConTypeDropdownOption,
                        AllDevicesDropdownOption
                    ]
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                Width: =320
                X: =0
                Y: =0
                ZIndex: =2

                Value1 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                    FieldDisplayName: ="Value"
                    FieldName: ="Value"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =1
                    ZIndex: =22

            "DeviceTabsPivot As 'Fluent Pivot (1.1.29)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =45
                ItemDisplayName: ="DisplayName"
                Items: =DeviceTabs
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                Theme: =AppThemeJson
                Visible: =CountRows(DeviceTabs) > 0
                Width: =200
                X: =0
                Y: =0
                ZIndex: =3

                "DisplayName3 As 'cat_PowerCAT.PivotTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="DisplayName"
                    FieldName: ="DisplayName"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =1
                    ZIndex: =20

                "Option1 As 'cat_PowerCAT.PivotTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="Option"
                    FieldName: ="Option"
                    FieldType: ="l"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =21

                "Option21 As 'cat_PowerCAT.PivotTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="Option2"
                    FieldName: ="Option2"
                    FieldType: ="l"
                    FieldVariantName: ="textualColumn"
                    Order: =3
                    ZIndex: =23

            DevicesGallery As gallery.BrowseLayout_Vertical_ThreeTextVariant_pcfCore:
                AlignInContainer: =AlignInContainer.SetByContainer
                BorderColor: =RGBA(166, 166, 166, 1)
                DelayItemLoading: =true
                Fill: =ColorValue(AppTheme.palette.neutralLighter)
                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                FocusedBorderThickness: =2
                Items: =VisibleDevicesList
                Layout: =Layout.Vertical
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =287
                LayoutMinWidth: =320
                LoadingSpinner: =LoadingSpinner.Data
                OnSelect: |-
                    =Set(
                        SelectedDevice,
                        LookUp(
                            'Device IO' As D,
                            D.DeviceIO = ThisItem.DeviceIO
                        )
                    );
                    Navigate(
                        DeviceScreen,
                        ScreenTransition.Cover,
                        {
                            ExpandedConnectionType: Blank(),
                            SettingsSelected: false
                        }
                    )
                TemplateSize: =150
                WrapCount: =RoundUp(Self.Width/500,0)
                ZIndex: =4

                Rectangle2 As rectangle:
                    BorderColor: =ColorValue(AppTheme.palette.neutralLight)
                    DisabledFill: =RGBA(0,0,0,0)
                    Fill: =RGBA(0,0,0,0)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =Parent.TemplateHeight
                    HoverFill: =RGBA(0,0,0,0)
                    OnSelect: =Select(Parent)
                    PressedFill: =RGBA(0,0,0,0)
                    TabIndex: =0
                    Width: =Parent.TemplateWidth
                    ZIndex: =1

                DeviceTemplateContainer As groupContainer.verticalAutoLayoutContainer:
                    DropShadow: =DropShadow.Light
                    Fill: =ColorValue(AppTheme.palette.white)
                    Height: =Parent.TemplateHeight
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGridColumns: =6
                    LayoutGridRows: =6
                    LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =10
                    PaddingRight: =20
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    Width: =Parent.TemplateWidth
                    ZIndex: =2

                    Title2 As Label:
                        AcceptsFocus: =false
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FillPortions: =1
                        FontSize: =10.5
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Italic: =false
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        OnChange: =false
                        OnSelect: =Select(Rectangle2)
                        Strikethrough: =false
                        TabIndex: =-1
                        Text: =ThisItem.Name
                        Underline: =false
                        VerticalAlignment: =VerticalAlign.Middle
                        Width: =
                        X: =12
                        Y: =
                        ZIndex: =1

                    Subtitle2 As Label:
                        AcceptsFocus: =false
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FillPortions: =1
                        FontSize: =9
                        FontWeight: =FontWeight.Normal
                        Height: =24
                        Italic: =false
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        OnChange: =false
                        OnSelect: =Select(Rectangle2)
                        Strikethrough: =false
                        TabIndex: =-1
                        Text: =ThisItem.'Modelo de Produto'.Referência
                        Underline: =false
                        VerticalAlignment: =VerticalAlign.Middle
                        Width: =Title2.Width
                        X: =Title2.X
                        Y: =Title2.Y + Title2.Height - 6
                        ZIndex: =2

                    Container1 As groupContainer.horizontalAutoLayoutContainer:
                        LayoutGridColumns: =6
                        LayoutGridRows: =6
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =0
                        LayoutMinWidth: =0
                        LayoutMode: =LayoutMode.Auto
                        RadiusBottomLeft: =4
                        RadiusBottomRight: =4
                        RadiusTopLeft: =4
                        RadiusTopRight: =4
                        ZIndex: =3

                        Subtitle2_1 As Label:
                            AcceptsFocus: =false
                            Color: =
                            DisplayMode: =DisplayMode.Edit
                            FillPortions: =1
                            FontSize: =9
                            FontWeight: =FontWeight.Normal
                            Height: =24
                            Italic: =false
                            LayoutMaxHeight: =
                            LayoutMaxWidth: =
                            OnChange: =false
                            OnSelect: =Select(Rectangle2)
                            Strikethrough: =false
                            TabIndex: =-1
                            Text: =ThisItem.Localização
                            Underline: =false
                            VerticalAlignment: =VerticalAlign.Middle
                            Width: =Title2.Width
                            X: =Title2.X
                            Y: =Title2.Y + Title2.Height - 6
                            ZIndex: =2

                        Subtitle2_2 As Label:
                            AcceptsFocus: =false
                            Alignment: =Align.Right
                            Color: =
                            DisplayMode: =DisplayMode.Edit
                            FillPortions: =1
                            FontSize: =9
                            FontWeight: =FontWeight.Normal
                            Height: =24
                            Italic: =false
                            LayoutMaxHeight: =
                            LayoutMaxWidth: =
                            OnChange: =false
                            OnSelect: =Select(Rectangle2)
                            Strikethrough: =false
                            TabIndex: =-1
                            Text: |-
                                =With(
                                    {
                                        Value: CountRows(
                                            Filter(
                                                'Device IO Connections' As C,
                                                C.Device.DeviceIO = ThisItem.DeviceIO,
                                                Or(
                                                    !IsBlank(C.'Connected To'),
                                                    And(
                                                        !IsBlank(C.'Connected To (Manual)'),
                                                        C.'Connected To (Manual)' <> "",
                                                        C.'Connected To (Manual)' <> " ",
                                                        C.'Connected To (Manual)' <> "  "
                                                    )
                                                ),
                                                Or(
                                                    GroupByDropdownSelectedOption <> GroupByConTypeDropdownOption,
                                                    C.'Tipo de Conexão' = SelectedDeviceTab.Option2
                                                )
                                            )
                                        )
                                    } As Counter,
                                    Switch(
                                        Counter.Value,
                                        0,
                                        "",
                                        1,
                                        Counter.Value & " conexão existente",
                                        Counter.Value & " conexões existentes"
                                    )
                                )
                            Underline: =false
                            VerticalAlignment: =VerticalAlign.Middle
                            Width: =Title2.Width
                            X: =Title2.X
                            Y: =Title2.Y + Title2.Height - 6
                            ZIndex: =3

                    DeviceInstalacaoContainer As groupContainer.horizontalAutoLayoutContainer:
                        LayoutGridColumns: =6
                        LayoutGridRows: =6
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =0
                        LayoutMinWidth: =0
                        LayoutMode: =LayoutMode.Auto
                        RadiusBottomLeft: =4
                        RadiusBottomRight: =4
                        RadiusTopLeft: =4
                        RadiusTopRight: =4
                        ZIndex: =4

                        InstalaçãoToggle As Toggle:
                            BasePaletteColor: =
                            Checked: =ThisItem.'Será Instalado'
                            DisplayMode: |-
                                =If(
                                    IsBlank(ThisItem.Produto),
                                    DisplayMode.Edit,
                                    DisplayMode.View
                                )
                            FillPortions: =1
                            Font: =Font.Lato
                            FontColor: =
                            Height: =35
                            Label: =If(Self.Checked,"Será Instalado","Ñ Será Instalado")
                            LayoutMaxHeight: =
                            LayoutMaxWidth: =
                            LayoutMinHeight: =35
                            LayoutMinWidth: =120
                            OnCheck: |-
                                =Patch(
                                    'Device IO',
                                    {
                                        DeviceIO: ThisItem.DeviceIO,
                                        'Será Instalado (Base)': true
                                    }
                                )
                            OnUncheck: |-
                                =Patch(
                                    'Device IO',
                                    {
                                        DeviceIO: ThisItem.DeviceIO,
                                        'Será Instalado (Base)': false
                                    }
                                )
                            Width: =113
                            X: =0
                            Y: =0
                            ZIndex: =1

                        DropdownCanvas2 As Dropdown.pcfdataset:
                            DefaultSelectedItems: |-
                                =AddColumns(
                                    [ThisItem.Produto] As P,
                                    Label,
                                    P.new_quantidade & "x " & P.new_referenciadoproduto & " " & If(Len(TrimEnds(P.new_localizacao)) > 0,"(" & P.new_localizacao & ")")
                                )
                                /*AddColumns(
                                
                                    Filter(
                                
                                        'Produtos-Serviço' As P,
                                
                                        P.'Produto-Serviço' = ThisItem.Produto.'Produto-Serviço'
                                
                                    ) As P,
                                
                                    Label,
                                
                                    P.Quantidade & "x " & P.'Referência do Produto' & " " & If(Len(TrimEnds(P.Localização)) > 0,"(" & P.Localização & ")")
                                
                                )*/
                            DisplayMode: |-
                                =If(
                                    ThisItem.Instalado = true,
                                    DisplayMode.Disabled,
                                    DisplayMode.Edit
                                )
                            FillPortions: =1
                            Height: =32
                            Items: |-
                                =ProdutosDisponiveisParaVinculo/*With(
                                    {
                                        Value: Filter(
                                            'Produtos-Serviço' As P,
                                            P.Status = 'Status (Produtos-Serviço)'.Active,
                                            P.Projeto.Projeto = CurrentProjeto.Projeto,
                                            !IsBlank(P.'Ordem de Serviço')
                                        )
                                    } As List,
                                    Filter(
                                        List.Value As P,
                                        CountRows(
                                            Filter(
                                                'Device IO' As D,
                                                D.Produto.'Produto-Serviço' = P.'Produto-Serviço'
                                            )
                                        ) <= P.Quantidade
                                    )
                                )*/
                            LayoutMaxHeight: =
                            LayoutMaxWidth: =
                            LayoutMinHeight: =32
                            LayoutMinWidth: =120
                            OnChange: |-
                                =With(
                                    Self.Selected As Selecionado,
                                    If(
                                        Selecionado.Label = "nenhum",
                                        Patch(
                                            'Device IO',
                                            {
                                                DeviceIO: ThisItem.DeviceIO,
                                                Produto: Blank(),
                                                'Modelo de Produto': Blank()
                                            }
                                        ),
                                        With(
                                            LookUp(
                                                'Produtos-Serviço' As P,
                                                P.'Produto-Serviço' = Selecionado.'Produto-Serviço'
                                            ) As ProdServ,
                                            Patch(
                                                'Device IO',
                                                {
                                                    DeviceIO: ThisItem.DeviceIO,
                                                    Produto: ProdServ,
                                                    'Modelo de Produto': LookUp(
                                                        'Modelos de Produto From Sharepoint Lists' As M,
                                                        M.'Modelos de Produto From Sharepoint List' = ProdServ.Produto.'Modelos de Produto From Sharepoint List'
                                                    )
                                                }
                                            )
                                        )
                                    )
                                )
                            Width: =320
                            X: =0
                            Y: =0
                            ZIndex: =2

                            Label2 As PowerApps_CoreControls_DropdownCanvasTemplate_dataField.textualColumn:
                                FieldDisplayName: ="Label"
                                FieldName: ="Label"
                                FieldType: ="e"
                                FieldVariantName: ="textualColumn"
                                Order: =2
                                ZIndex: =2

                PrintCableLabelButtonCanvas_1 As Button:
                    Appearance: ='ButtonCanvas.Appearance'.Transparent
                    BasePaletteColor: =
                    BorderColor: =
                    DisplayMode: =DisplayMode.Edit
                    FontColor: =
                    Height: =32
                    Icon: ="Print"
                    Layout: ='ButtonCanvas.Layout'.IconOnly
                    OnSelect: |-
                        =UpdateContext({SpinCounter: SpinCounter + 1});
                        With(
                            LookUp(
                                'Device IO' As D,
                                D.DeviceIO = ThisItem.DeviceIO
                            ) As Device,
                            '(ImpressãodeEtiqueta)-Imprimiretiquetadeequipamento'.Run(
                                Device.Name,
                                Device.Localização
                            )
                        );
                        UpdateContext({SpinCounter: SpinCounter - 1})
                    Width: =Self.Height
                    X: =Parent.TemplateWidth-Self.Width-5
                    Y: |
                        =5
                    ZIndex: =3

                RootCheckbox As Checkbox:
                    BasePaletteColor: =
                    Checked: =RootDeviceId = ThisItem.DeviceIO
                    DisplayMode: =DisplayMode.Edit
                    Font: =Font.Lato
                    FontColor: =
                    Height: =32
                    Label: ="Raiz?"
                    OnCheck: |-
                        =UpdateContext({RootDeviceId:ThisItem.DeviceIO})
                    OnSelect: =
                    OnUncheck: =false
                    Width: =70
                    X: =PrintCableLabelButtonCanvas_1.X-Self.Width
                    Y: =PrintCableLabelButtonCanvas_1.Y
                    ZIndex: =4

        GeneratePendingDevicesButton As Button:
            BorderColor: =
            BorderRadius: =10
            ButtonType: ="Primary"
            DisabledBorderColor: =
            DisabledFillColor: =
            DisabledTextColor: =
            DisplayMode: =DisplayMode.Edit
            FillColor: =ColorValue(AppTheme.palette.themePrimary)
            FontWeight: =FontWeight.Semibold
            Height: =40
            HoverBorderColor: =
            HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
            HoverTextColor: =
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =32
            OnChange: =false
            OnSelect: |-
                =ClearCollect(
                    ProgressCol,
                    true
                );
                Clear(ProgressCol);
                UpdateContext(
                    {
                        SpinCounter: SpinCounter + 1,
                        ProgressMax: CountRows(PendingProducts)
                    }
                );
                If(
                    CountRows(PendingProducts) > 0,
                    ForAll(
                        PendingProducts As Prod,
                        Collect(
                            ProgressCol,
                            true
                        );
                        With(
                            {
                                Raw: ParseJSON(
                                    LookUp(
                                        'Modelos de Produto From Sharepoint Lists' As M,
                                        M.'Modelos de Produto From Sharepoint List' = Prod.Produto.'Modelos de Produto From Sharepoint List',
                                        M.'Device IO Template (JSON)'
                                    )
                                )
                            } As RawTemplate,
                            With(
                                {
                                    Connections: ForAll(
                                        Table(RawTemplate.Raw.Connections) As Item,
                                        {
                                            Name: Text(Item.Value.Name),
                                            Type: Switch(
                                                Value(Item.Value.Type),
                                                100000000,
                                                [@'Tipo de Conexão'].HDMI,
                                                100000001,
                                                [@'Tipo de Conexão'].'Áudio Analógico',
                                                100000002,
                                                [@'Tipo de Conexão'].Toslink,
                                                100000003,
                                                [@'Tipo de Conexão'].'Trigger 12V',
                                                100000004,
                                                [@'Tipo de Conexão'].Speaker,
                                                100000005,
                                                [@'Tipo de Conexão'].Ethernet,
                                                100000006,
                                                [@'Tipo de Conexão'].IR,
                                                100000007,
                                                [@'Tipo de Conexão'].Serial,
                                                100000008,
                                                [@'Tipo de Conexão'].RF,
                                                100000009,
                                                [@'Tipo de Conexão'].RNET,
                                                100000010,
                                                [@'Tipo de Conexão'].ACNET,
                                                100000011,
                                                [@'Tipo de Conexão'].PNET,
                                                100000012,
                                                [@'Tipo de Conexão'].'Luz ON/OFF',
                                                100000013,
                                                [@'Tipo de Conexão'].'Luz Triac Dimmer',
                                                100000014,
                                                [@'Tipo de Conexão'].'Luz PWM Dimmer',
                                                100000015,
                                                [@'Tipo de Conexão'].Motor,
                                                100000016,
                                                [@'Tipo de Conexão'].GPIO,
                                                100000017,
                                                'Tipo de Conexão'.'Power 110V',
                                                100000018,
                                                'Tipo de Conexão'.'Power 220V'
                                            ),
                                            Direction: Switch(
                                                Value(Item.Value.Direction),
                                                100000000,
                                                [@'Direção de Conexão'].Input,
                                                100000001,
                                                [@'Direção de Conexão'].Output,
                                                100000002,
                                                [@'Direção de Conexão'].Bidirectional,
                                                100000003,
                                                [@'Direção de Conexão'].Bus
                                            )
                                        }
                                    )
                                } As Template,
                                ForAll(
                                    Sequence(
                                        Prod.Quantidade - Prod.IOCount,
                                        1,
                                        1
                                    ),
                                    With(
                                        With(
                                            LookUp(
                                                'Modelos de Produto From Sharepoint Lists' As M,
                                                M.'Modelos de Produto From Sharepoint List' = Prod.Produto.'Modelos de Produto From Sharepoint List'
                                            ) As Modelo,
                                            Patch(
                                                'Device IO',
                                                Defaults('Device IO'),
                                                {
                                                    'Modelo de Produto': Modelo,
                                                    Name: Modelo.Referência & " (" & Text(
                                                        CountRows(
                                                            Filter(
                                                                'Device IO' As D,
                                                                D.Projeto.Projeto = CurrentProjeto.Projeto,
                                                                D.'Modelo de Produto'.'Modelos de Produto From Sharepoint List' = Modelo.'Modelos de Produto From Sharepoint List'
                                                            )
                                                        ) + 1,
                                                        "00"
                                                    ) & ")",
                                                    Localização: NewDeviceLocalTextBox.Value,
                                                    Projeto: LookUp(
                                                        Projetos As P,
                                                        P.Projeto = CurrentProjeto.Projeto
                                                    ),
                                                    Produto: LookUp(
                                                        'Produtos-Serviço' As P,
                                                        P.'Produto-Serviço' = Prod.'Produto-Serviço'
                                                    )
                                                }
                                            )
                                        ) As NewDeviceRaw,
                                        With(
                                            LookUp(
                                                'Device IO' As D,
                                                D.DeviceIO = NewDeviceRaw.DeviceIO
                                            ) As NewDevice,
                                            ForAll(
                                                Template.Connections As C,
                                                Patch(
                                                    'Device IO Connections',
                                                    Defaults('Device IO Connections'),
                                                    {
                                                        Device: NewDevice,
                                                        'Tipo de Conexão': C.Type,
                                                        Direção: C.Direction,
                                                        Name: C.Name,
                                                        Projeto: LookUp(
                                                            Projetos As P,
                                                            P.Projeto = CurrentProjeto.Projeto
                                                        )
                                                    }
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    false
                );
                UpdateContext(
                    {
                        SpinCounter: SpinCounter - 1,
                        ProgressMax: 0
                    }
                );
                Clear(ProgressCol)
            PressedBorderColor: =
            PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
            PressedTextColor: =
            Text: ="Gerar " & CountRows(PendingProducts)&" Produtos Pendentes"
            TextColor: =
            Visible: =CountRows(PendingProducts) > 0
            Width: =96
            X: =0
            Y: =0
            ZIndex: =4

        TextCanvas1 As Text:
            Align: ='TextCanvas.Align'.Center
            BorderColor: =
            DisplayMode: =DisplayMode.Edit
            Fill: =
            FillPortions: =10
            FontColor: =
            Height: =32
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =32
            Text: |-
                =Concat(
                    Distinct(
                        PendingProducts As P,
                        P.Produto.Referência
                    ),
                    Value,
                    "
                "
                )
            Visible: =ShowPendingDevicesList
            Width: =96
            X: =0
            Y: =0
            ZIndex: =5

        ShowPendingDevicesButton As Button:
            BorderColor: =
            BorderRadius: =10
            DisabledBorderColor: =
            DisabledFillColor: =
            DisabledTextColor: =
            DisplayMode: =DisplayMode.Edit
            FillColor: =ColorValue(AppTheme.palette.themePrimary)
            FontWeight: =FontWeight.Semibold
            Height: =40
            HoverBorderColor: =
            HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
            HoverTextColor: =
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =32
            OnChange: =false
            OnSelect: |-
                =UpdateContext(
                    {
                        ShowPendingDevicesList: If(
                            ShowPendingDevicesList = true,
                            false,
                            true
                        )
                    }
                )
            PressedBorderColor: =
            PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
            PressedTextColor: =
            Text: ="Mostrar " & CountRows(PendingProducts)&" Produtos Pendentes"
            TextColor: =
            Visible: =CountRows(PendingProducts) > 0
            Width: =96
            X: =0
            Y: =0
            ZIndex: =6

    AddNewDeviceBackgroundContainer As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: |-
            =RGBA(0, 0, 0, 0.5
            )
        Height: =Parent.Height
        LayoutGridColumns: =6
        LayoutGridRows: =6
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =ShowAddNewDeviceWindow = true
        Width: =Parent.Width
        ZIndex: =2

        AddNewDeviceContainer As groupContainer.verticalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            Fill: =ColorValue(AppTheme.palette.white)
            Height: =420
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =10
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutJustifyContent: =LayoutJustifyContent.Center
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =20
            PaddingLeft: =20
            PaddingRight: =20
            PaddingTop: =20
            RadiusBottomLeft: =10
            RadiusBottomRight: =10
            RadiusTopLeft: =10
            RadiusTopRight: =10
            Width: =Parent.Width-40
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2
            ZIndex: =1

            SelectDeviceModelLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Center
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Adicionar Produto"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =1

            NewDeviceModelLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Left
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Modelo do Produto"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =2

            "ProdutoPicker As 'Fluent Picker (1.1.29)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =32
                HintText: ="Pesquisar produtos"
                Items: |
                    =ProdutoPickerSelectedCollection
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                MaxTags: =1
                MinimumSearchTermLength: =2
                NoSuggestionFoundMessage: ="Nenhum sugestão encontrada"
                OnChange: |-
                    =Switch(
                        Self.TagEvent,
                        "Add",
                        If(
                            !IsBlank(Self.TagKey),
                            ClearCollect(
                                ProdutoPickerSelectedCollection,
                                {
                                    cr22f_modelosdeprodutofromsharepointlistid: Self.TagKey,
                                    cr22f_title: Self.TagDisplayName
                                }
                            )
                        ),
                        "Remove",
                        Clear(ProdutoPickerSelectedCollection)
                    )
                OnSelect: =
                SearchTermToShortMessage: ="Continue Digitando..."
                Suggestions_Items: |-
                    =Filter(
                        Search(
                            'Modelos de Produto From Sharepoint Lists',
                            Self.SearchTerm,
                            Descrição,
                            Referência,
                            'Nome do Fabricante',
                            'Fabricante (Nome)'
                        ) As P,
                        //!IsBlank(P.'Device IO Template (JSON)'),
                        P.Status = 'Status (Modelos de Produto From Sharepoint Lists)'.Active
                    )
                SuggestionsDisplayName: ="cr22f_title"
                SuggestionsKey: ="cr22f_modelosdeprodutofromsharepointlistid"
                SuggestionsSubDisplayName: ="new_descricao"
                TagsDisplayName: ="cr22f_title"
                Theme: =AppThemeJson
                Width: =200
                X: =0
                Y: =0
                ZIndex: =3

                "cr22f_title1 As 'cat_PowerCAT.PickerTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="cr22f_title"
                    FieldName: ="cr22f_title"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =18

                "cr22f_modelosdeprodutofromsharepointlistid1 As 'cat_PowerCAT.PickerTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="cr22f_modelosdeprodutofromsharepointlistid"
                    FieldName: ="cr22f_modelosdeprodutofromsharepointlistid"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =19

            NewDeviceLocalLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Left
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Localização"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =4

            "NewDeviceLocalTextBox As 'Text box'":
                ColorBackground: =
                ColorText: =
                DisplayMode: =DisplayMode.Edit
                Height: =32
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                Value: =Coalesce(LastAddedDeviceLocation,"")
                Width: =320
                X: =0
                Y: =0
                ZIndex: =5

            NewDeviceQuantLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Left
                AutoHeight: =false
                Color: =
                ContentLanguage: =""
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontSize: =10.5
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                OnSelect: =false
                Overflow: ="Hidden"
                PaddingBottom: =0
                PaddingEnd: =0
                PaddingStart: =0
                PaddingTop: =0
                Strikethrough: =false
                TabIndex: =0
                Text: ="Quantidade"
                TextRole: ="Default"
                Tooltip: =""
                Underline: =false
                VerticalAlignment: ="middle"
                Visible: =true
                Width: =320
                Wrap: =true
                X: =47
                Y: =446
                ZIndex: =6

            "NewDeviceQuantNumberInput As 'Number input'":
                BasePaletteColor: =
                BorderColor: =
                DisplayMode: =DisplayMode.Edit
                Fill: =
                Height: =32
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                Max: =100
                Min: =1
                Precision: ='NumberInput.Precision'.'0'
                Width: =320
                X: =0
                Y: =0
                ZIndex: =7

            AddDeviceButton As Button:
                BorderColor: =
                BorderRadius: =10
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =
                DisplayMode: |-
                    =If(
                        CountRows(ProdutoPickerSelectedCollection) <= 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    )
                FillColor: =ColorValue(AppTheme.palette.themePrimary)
                FontWeight: =FontWeight.Semibold
                Height: =40
                HoverBorderColor: =
                HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                OnChange: =false
                OnSelect: |-
                    =UpdateContext({SpinCounter: SpinCounter + 1});
                    If(
                        CountRows(ProdutoPickerSelectedCollection) > 0,
                        ForAll(
                            Sequence(
                                Max(
                                    NewDeviceQuantNumberInput.Value,
                                    1
                                ),
                                0,
                                0
                            ),
                            With(
                                {
                                    Raw: ParseJSON(
                                        Coalesce(
                                            LookUp(
                                                'Modelos de Produto From Sharepoint Lists' As M,
                                                M.'Modelos de Produto From Sharepoint List' = GUID(First(ProdutoPickerSelectedCollection).cr22f_modelosdeprodutofromsharepointlistid),
                                                If(
                                                    Len(M.'Device IO Template (JSON)') < 2,
                                                    Blank(),
                                                    M.'Device IO Template (JSON)'
                                                )
                                            ),
                                            "{}"
                                        )
                                    )
                                } As RawTemplate,
                                With(
                                    {
                                        Connections: ForAll(
                                            Table(RawTemplate.Raw.Connections) As Item,
                                            {
                                                Name: Text(Item.Value.Name),
                                                Type: Switch(
                                                    Value(Item.Value.Type),
                                                    100000000,
                                                    [@'Tipo de Conexão'].HDMI,
                                                    100000001,
                                                    [@'Tipo de Conexão'].'Áudio Analógico',
                                                    100000002,
                                                    [@'Tipo de Conexão'].Toslink,
                                                    100000003,
                                                    [@'Tipo de Conexão'].'Trigger 12V',
                                                    100000004,
                                                    [@'Tipo de Conexão'].Speaker,
                                                    100000005,
                                                    [@'Tipo de Conexão'].Ethernet,
                                                    100000006,
                                                    [@'Tipo de Conexão'].IR,
                                                    100000007,
                                                    [@'Tipo de Conexão'].Serial,
                                                    100000008,
                                                    [@'Tipo de Conexão'].RF,
                                                    100000009,
                                                    [@'Tipo de Conexão'].RNET,
                                                    100000010,
                                                    [@'Tipo de Conexão'].ACNET,
                                                    100000011,
                                                    [@'Tipo de Conexão'].PNET,
                                                    100000012,
                                                    [@'Tipo de Conexão'].'Luz ON/OFF',
                                                    100000013,
                                                    [@'Tipo de Conexão'].'Luz Triac Dimmer',
                                                    100000014,
                                                    [@'Tipo de Conexão'].'Luz PWM Dimmer',
                                                    100000015,
                                                    [@'Tipo de Conexão'].Motor,
                                                    100000016,
                                                    [@'Tipo de Conexão'].GPIO,
                                                    100000017,
                                                    'Tipo de Conexão'.'Power 110V',
                                                    100000018,
                                                    'Tipo de Conexão'.'Power 220V'
                                                ),
                                                Direction: Switch(
                                                    Value(Item.Value.Direction),
                                                    100000000,
                                                    [@'Direção de Conexão'].Input,
                                                    100000001,
                                                    [@'Direção de Conexão'].Output,
                                                    100000002,
                                                    [@'Direção de Conexão'].Bidirectional,
                                                    100000003,
                                                    [@'Direção de Conexão'].Bus
                                                )
                                            }
                                        )
                                    } As Template,
                                    With(
                                        With(
                                            LookUp(
                                                'Modelos de Produto From Sharepoint Lists' As M,
                                                M.'Modelos de Produto From Sharepoint List' = GUID(First(ProdutoPickerSelectedCollection).cr22f_modelosdeprodutofromsharepointlistid)
                                            ) As Modelo,
                                            Patch(
                                                'Device IO',
                                                Defaults('Device IO'),
                                                {
                                                    'Modelo de Produto': Modelo,
                                                    Name: Modelo.Referência & " (" & Text(
                                                        CountRows(
                                                            Filter(
                                                                'Device IO' As D,
                                                                D.Projeto.Projeto = CurrentProjeto.Projeto,
                                                                D.'Modelo de Produto'.'Modelos de Produto From Sharepoint List' = Modelo.'Modelos de Produto From Sharepoint List'
                                                            )
                                                        ) + 1,
                                                        "00"
                                                    ) & ")",
                                                    Localização: NewDeviceLocalTextBox.Value,
                                                    Projeto: LookUp(
                                                        Projetos As P,
                                                        P.Projeto = CurrentProjeto.Projeto
                                                    )
                                                }
                                            )
                                        ) As NewDeviceRaw,
                                        With(
                                            LookUp(
                                                'Device IO' As D,
                                                D.DeviceIO = NewDeviceRaw.DeviceIO
                                            ) As NewDevice,
                                            ForAll(
                                                Template.Connections As C,
                                                Patch(
                                                    'Device IO Connections',
                                                    Defaults('Device IO Connections'),
                                                    {
                                                        Device: NewDevice,
                                                        'Tipo de Conexão': C.Type,
                                                        Direção: C.Direction,
                                                        Name: C.Name,
                                                        Projeto: LookUp(
                                                            Projetos As P,
                                                            P.Projeto = CurrentProjeto.Projeto
                                                        )
                                                    }
                                                )
                                            )
                                        )
                                    );
                                );
                            )
                        ),
                        false
                    );
                    //Clear(ProdutoPickerSelectedCollection);
                    UpdateContext(
                        {
                            ShowAddNewDeviceWindow: false,
                            LastAddedDeviceLocation: NewDeviceLocalTextBox.Value,
                            SpinCounter: SpinCounter - 1
                        }
                    );
                    Reset(NewDeviceQuantNumberInput)
                PressedBorderColor: =
                PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                PressedTextColor: =
                Text: ="Confirmar"
                TextColor: =
                Width: =96
                X: =0
                Y: =0
                ZIndex: =8

            CloseAddDevicesButton As Button:
                BorderColor: =ColorValue(AppTheme.palette.neutralTertiary)
                BorderRadius: =10
                BorderStyle: =BorderStyle.Solid
                BorderThickness: =2
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =ColorValue(AppTheme.palette.white)
                DisplayMode: =DisplayMode.Edit
                FillColor: =ColorValue(AppTheme.palette.white)
                FontWeight: =FontWeight.Semibold
                Height: =40
                HoverBorderColor: =ColorValue(AppTheme.palette.white)
                HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                OnChange: =false
                OnSelect: |-
                    =//Clear(ProdutoPickerSelectedCollection);
                    UpdateContext(
                        {
                            ShowAddNewDeviceWindow: false
                        }
                    );
                    Reset(NewDeviceQuantNumberInput)
                PressedBorderColor: =
                PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                PressedTextColor: =
                Text: ="Fechar"
                TextColor: =ColorValue(AppTheme.palette.neutralSecondary)
                Width: =96
                X: =0
                Y: =0
                ZIndex: =9

    OpenProjectBackgroundContainer As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: |-
            =RGBA(0, 0, 0, 0.5
            )
        Height: =Parent.Height
        LayoutGridColumns: =6
        LayoutGridRows: =6
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =IsBlank(CurrentProjeto)
        Width: =Parent.Width
        ZIndex: =3

        OpenProjectContainer As groupContainer.verticalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            Fill: =ColorValue(AppTheme.palette.white)
            Height: =250
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =20
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutJustifyContent: =LayoutJustifyContent.Center
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =20
            PaddingLeft: =20
            PaddingRight: =20
            PaddingTop: =20
            RadiusBottomLeft: =10
            RadiusBottomRight: =10
            RadiusTopLeft: =10
            RadiusTopRight: =10
            Width: =Parent.Width-40
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2
            ZIndex: =1

            SelectProjectLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Center
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Selecione o Projeto Desejado"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =1

            "ProjetoPicker As 'Fluent Picker (1.1.29)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                Height: =32
                HintText: ="Pesquisar projetos"
                Items: |
                    =ProjetoPickerSelectedCollection
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                MaxTags: =1
                MinimumSearchTermLength: =2
                NoSuggestionFoundMessage: ="Nenhum sugestão encontrada"
                OnChange: |-
                    =Switch(
                        Self.TagEvent,
                        "Add",
                        If(
                            !IsBlank(Self.TagKey),
                            ClearCollect(
                                ProjetoPickerSelectedCollection,
                                {
                                    cr22f_projetoid: Self.TagKey,
                                    cr22f_apelido: Self.TagDisplayName
                                }
                            )
                        ),
                        "Remove",
                        Clear(ProjetoPickerSelectedCollection)
                    )
                OnSelect: =
                SearchTermToShortMessage: ="Continue Digitando..."
                Suggestions_Items: |-
                    =SortByColumns(
                        Search(
                            Projetos,
                            Self.SearchTerm,
                            Apelido,
                            'Nome do Cliente (Fx)',
                            'Email do Cliente',
                            'Endereço Completo (Fx)'
                        ),
                        "cr22f_apelido",
                        SortOrder.Ascending
                    )
                SuggestionsDisplayName: ="cr22f_apelido"
                SuggestionsKey: ="cr22f_projetoid"
                SuggestionsSubDisplayName: ="new_nomedoclientefx"
                TagsDisplayName: ="cr22f_apelido"
                Theme: =AppThemeJson
                Width: =200
                X: =0
                Y: =0
                ZIndex: =2

                "cr22f_apelido1 As 'cat_PowerCAT.PickerTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="cr22f_apelido"
                    FieldName: ="cr22f_apelido"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =1
                    ZIndex: =24

                "cr22f_projetoid1 As 'cat_PowerCAT.PickerTemplate_dataField'.textualColumn":
                    FieldDisplayName: ="cr22f_projetoid"
                    FieldName: ="cr22f_projetoid"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =25

            OpenProjectButton As Button:
                BorderColor: =
                BorderRadius: =10
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =
                DisplayMode: |-
                    =If(
                        IsBlank(First(ProjetoPickerSelectedCollection).cr22f_projetoid),
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    )
                FillColor: =ColorValue(AppTheme.palette.themePrimary)
                FontWeight: =FontWeight.Semibold
                Height: =40
                HoverBorderColor: =
                HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                OnChange: =false
                OnSelect: |-
                    =If(
                        !IsBlank(First(ProjetoPickerSelectedCollection).cr22f_projetoid),
                        Set(
                            CurrentProjeto,
                            LookUp(
                                Projetos As P,
                                P.Projeto = GUID(First(ProjetoPickerSelectedCollection).cr22f_projetoid)
                            )
                        ),
                        Set(
                            CurrentProjeto,
                            Blank()
                        )
                    );
                    Clear(ProjetoPickerSelectedCollection)
                PressedBorderColor: =
                PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                PressedTextColor: =
                Text: ="Abrir Projeto"
                TextColor: =
                Width: =96
                X: =0
                Y: =0
                ZIndex: =4

            CloseRecibosWindowButton As Button:
                BorderColor: =ColorValue(AppTheme.palette.neutralTertiary)
                BorderRadius: =10
                BorderStyle: =BorderStyle.Solid
                BorderThickness: =2
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =ColorValue(AppTheme.palette.white)
                DisplayMode: =DisplayMode.Disabled
                FillColor: =ColorValue(AppTheme.palette.white)
                FontWeight: =FontWeight.Semibold
                Height: =40
                HoverBorderColor: =ColorValue(AppTheme.palette.white)
                HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                OnChange: =false
                OnSelect: |-
                    =UpdateContext(
                        {
                            ShowRecibosWindow: false,
                            SelectedTaskId: Blank()
                        }
                    )
                PressedBorderColor: =
                PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                PressedTextColor: =
                Text: ="Fechar"
                TextColor: =ColorValue(AppTheme.palette.neutralSecondary)
                Width: =96
                X: =0
                Y: =0
                ZIndex: =5

    CopyCSVBackgroundContainer As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: |-
            =RGBA(0, 0, 0, 0.5
            )
        Height: =Parent.Height
        LayoutGridColumns: =6
        LayoutGridRows: =6
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =Len(CSVConexoes)> 0 || Len(CSVEquipamentos) > 0
        Width: =Parent.Width
        ZIndex: =5

        CopyCSVContainer As groupContainer.verticalAutoLayoutContainer:
            DropShadow: =DropShadow.Light
            Fill: =ColorValue(AppTheme.palette.white)
            Height: =350
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =20
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutJustifyContent: =LayoutJustifyContent.Center
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =20
            PaddingLeft: =20
            PaddingRight: =20
            PaddingTop: =20
            RadiusBottomLeft: =10
            RadiusBottomRight: =10
            RadiusTopLeft: =10
            RadiusTopRight: =10
            Width: =Parent.Width-40
            X: =(Parent.Width-Self.Width)/2
            Y: =(Parent.Height-Self.Height)/2
            ZIndex: =1

            CopyCSVConLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Center
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Copiar Arquivo CSV de Conexões"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =1

            PCFCopyTextComponent1 As PCFCopyTextComponent:
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =200
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinWidth: =200
                MaxLength: =10000000000000
                MultiLine: =true
                ReadOnly: =true
                Value: =CSVConexoes
                Width: =200
                X: =0
                Y: =0
                ZIndex: =2

            CopyCSVEquipLabel As Label:
                AcceptsFocus: =false
                Alignment: =Align.Center
                Color: =
                DisplayMode: =DisplayMode.Edit
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =32
                Italic: =false
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                Strikethrough: =false
                Text: ="Copiar Arquivo CSV de Equipamentos"
                Underline: =false
                Width: =320
                X: =47
                Y: =446
                ZIndex: =3

            PCFCopyTextComponent2 As PCFCopyTextComponent:
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =200
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinWidth: =200
                MaxLength: =10000000000000
                MultiLine: =true
                ReadOnly: =true
                Value: =CSVEquipamentos
                Width: =200
                X: =0
                Y: =0
                ZIndex: =4

            CloseCopyCSVWindowButton As Button:
                BorderColor: =ColorValue(AppTheme.palette.neutralTertiary)
                BorderRadius: =10
                BorderStyle: =BorderStyle.Solid
                BorderThickness: =2
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =ColorValue(AppTheme.palette.white)
                DisplayMode: =DisplayMode.Edit
                FillColor: =ColorValue(AppTheme.palette.white)
                FontWeight: =FontWeight.Semibold
                Height: =40
                HoverBorderColor: =ColorValue(AppTheme.palette.white)
                HoverFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                OnChange: =false
                OnSelect: |-
                    =UpdateContext({CSVConexoes: "",CSVEquipamentos:""})
                PressedBorderColor: =
                PressedFillColor: =ColorFade(ColorValue(AppTheme.palette.themePrimary),20%)
                PressedTextColor: =
                Text: ="Fechar"
                TextColor: =ColorValue(AppTheme.palette.neutralSecondary)
                Width: =96
                X: =0
                Y: =0
                ZIndex: =5

    "Spinner1 As 'Fluent Spinner (1.1.29) Preview'":
        BackgroundColor: |-
            ="#00000050"
        DisplayMode: =DisplayMode.Edit
        Height: =Parent.Height
        Label: |-
            ="Carregando" & If(
                ProgressMax > 0,
                " " & CountRows(ProgressCol) & "/" & ProgressMax & " ",
                ""
            ) & "..."
        SpinnerSize: ='PowerCAT.Spinner.SpinnerSize'.Large
        Theme: =AppThemeJson
        Visible: =SpinCounter > 0
        Width: =Parent.Width
        X: =0.00
        Y: =0.00
        ZIndex: =6

    GenerateCSVButtonCanvas As Button:
        BasePaletteColor: =
        BorderColor: =
        DisplayMode: =DisplayMode.Edit
        FontColor: =
        Height: =32
        OnSelect: |-
            =UpdateContext({SpinCounter: SpinCounter + 1});
            // start index connections by root devices
            ClearCollect(
                ConsCol,
                AddColumns(
                    ShowColumns(
                        FirstN(
                            'Device IO Connections',
                            2
                        ),
                        //Device,
            //'Connected To',
                        'Display Name',
                        Direção,
                        'Device IO Connection'
                    ),
                    //local_index,
            // 0,
                    local_root,
                    GUID(),
                    local_rootcon,
                    GUID(),
                    local_deviceid,
                    GUID(),
                    local_connectedtoid,
                    GUID()
                )
            );
            Clear(ConsCol);
            With(
                {
                    Value: Distinct(
                        DeviceIOs As Dev,
                        Dev.DeviceIO
                    )
                } As AllDeviceIOsIds,
                With(
                    {
                        Value: DropColumns(
                            AddColumns(
                                ShowColumns(
                                    Filter(
                                        'Device IO Connections' As Con,
                                        Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                        !IsBlank(Con.'Connected To'),
                                        !IsBlank(Con.Device),
                                        Con.Device.Projeto.Projeto = CurrentProjeto.Projeto,
                                        Con.Device.DeviceIO in AllDeviceIOsIds.Value
                                    ),
                                    Device,
                                    'Connected To',
                                    'Display Name',
                                    Direção,
                                    'Device IO Connection'
                                ) As Con,
                                local_deviceid,
                                Con.new_Device.DeviceIO,
                                local_connectedtoid,
                                Con.new_ConnectedTo.'Device IO Connection'
                            ),
                            new_Device,
                            new_ConnectedTo
                        )
                    } As SpeakerCons,
                    With(
                        {
                            Value: Distinct(
                                SpeakerCons.Value As Con,
                                Con.local_deviceid
                            )
                        } As SpeakerDevicesIds,
                        With(
                            {
                                Value: Filter(
                                    SpeakerDevicesIds.Value As DevId,
                                    CountRows(
                                        Filter(
                                            SpeakerCons.Value As Con,
                                            Con.local_deviceid = DevId.Value,
                                            Con.new_direcao = 'Direção de Conexão'.Input
                                        )
                                    ) = 0,
                                    CountRows(
                                        Filter(
                                            SpeakerCons.Value As Con,
                                            Con.local_deviceid = DevId.Value,
                                            Con.new_direcao = 'Direção de Conexão'.Output
                                        )
                                    ) > 0
                                )
                            } As RootSpeakerDevicesIds,
                            ForAll(
                                RootSpeakerDevicesIds.Value As CurrentRootDevice,
                                With(
                                    {
                                        Value: Filter(
                                            SpeakerCons.Value As Con,
                                            Con.local_deviceid = CurrentRootDevice.Value
                                        )
                                    } As RootCons,
                                    ForAll(
                                        RootCons.Value As CurrentRootCon,
                                        Collect(
                                            ConsCol,
                                            Patch(
                                                CurrentRootCon,
                                                {
                                                    //local_index: 0,
                                                    local_root: CurrentRootDevice.Value,
                                                    local_rootcon: CurrentRootCon.new_deviceioconnectionid
                                                }
                                            )
                                        )
                                    );
                                    ForAll(
                                        RootCons.Value As CurrentRootCon,
                                        ForAll(
                                            Filter(
                                                SpeakerCons.Value As Con,
                                                Not(
                                                    Con.new_deviceioconnectionid in ForAll(
                                                        ConsCol As ColCon,
                                                        ColCon.new_deviceioconnectionid
                                                    )
                                                )
                                            ) As NewCon,
                                            With(
                                                LookUp(
                                                    ConsCol As ColCon,
                                                    And(
                                                        Or(
                                                            ColCon.local_connectedtoid = NewCon.new_deviceioconnectionid,
                                                            ColCon.local_deviceid = NewCon.local_deviceid
                                                        ),
                                                        !IsBlank(ColCon.local_root)
                                                    )
                                                ) As NeighborColCon,
                                                If(
                                                    IsBlank(NeighborColCon.new_deviceioconnectionid),
                                                    Collect(
                                                        ConsCol,
                                                        Patch(
                                                            NewCon,
                                                            {
                                                                // local_index: 0,
                                                                local_root: Blank(),
                                                                local_rootcon: Blank()
                                                            }
                                                        )
                                                    ),
                                                    Collect(
                                                        ConsCol,
                                                        Patch(
                                                            NewCon,
                                                            {
                                                                /*local_index: NeighborColCon.local_index + If(
                                                                    NewCon.new_direcao = 'Direção de Conexão'.Input,
                                                                    1,
                                                                    -1
                                                                ),*/
                                                                local_root: NeighborColCon.local_root,
                                                                local_rootcon: NeighborColCon.local_rootcon
                                                            }
                                                        )
                                                    )
                                                )
                                            )
                                        );
                                        ForAll(
                                            Sequence(
                                                CountRows(SpeakerCons.Value),
                                                0,
                                                1
                                            ),
                                            With(
                                                {
                                                    Value: Filter(
                                                        ConsCol As Con,
                                                        IsBlank(Con.local_root)
                                                    )
                                                } As UnpairedConnections,
                                                ForAll(
                                                    UnpairedConnections.Value As UnpairedCon,
                                                    With(
                                                        LookUp(
                                                            ConsCol As ColCon,
                                                            And(
                                                                Or(
                                                                    ColCon.local_connectedtoid = UnpairedCon.new_deviceioconnectionid,
                                                                    ColCon.local_deviceid = UnpairedCon.local_deviceid
                                                                ),
                                                                !IsBlank(ColCon.local_root)
                                                            )
                                                        ) As NeighborColCon,
                                                        If(
                                                            !IsBlank(NeighborColCon.new_deviceioconnectionid),
                                                            Collect(
                                                                ConsCol,
                                                                Patch(
                                                                    UnpairedCon,
                                                                    {
                                                                        /*local_index: NeighborColCon.local_index + If(
                                                                    NewCon.new_direcao = 'Direção de Conexão'.Input,
                                                                    1,
                                                                    -1
                                                                ),*/
                                                                        local_root: NeighborColCon.local_root,
                                                                        local_rootcon: NeighborColCon.local_rootcon
                                                                    }
                                                                )
                                                            )
                                                        )
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
            // end index connections by root devices
            // start generate csv text
            UpdateContext(
                {
                    CSVConexoes: "Texto,Texto B,Nome do Projeto,Created On
            " & Concat(
                        Filter(
                            ForAll(
                                VisibleDevicesList As Dev,
                                Concat(
                                    Filter(
                                        ForAll(
                                            Filter(
                                                'Device IO Connections' As Con,
                                                Con.Device.DeviceIO = Dev.DeviceIO,
                                                Con.Status = 'Status (Device IO Connections)'.Active
                                            ) As Con,
                                            If(
                                                And(
                                                    Or(
                                                        !IsBlank(Con.'Connected To'),
                                                        !IsBlank(Con.'Connected To (Manual)'),
                                                        Len(Con.'Connected To (Manual)') > 0
                                                    ),
                                                    Not(
                                                        And(
                                                            Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                                            Con.Direção = 'Direção de Conexão'.Output,
                                                            Not(
                                                                Con.'Device IO Connection' in Distinct(
                                                                    ConsCol As ColCon,
                                                                    ColCon.local_rootcon
                                                                )
                                                            )
                                                        )
                                                    )
                                                ),
                                                Substitute(
                                                    Con.Device.Name & " - " & Con.Name,
                                                    ",",
                                                    "."
                                                ) & "," & Substitute(
                                                    If(
                                                        IsBlank(Con.'Connected To'),
                                                        Con.'Connected To (Manual)',
                                                        If(
                                                            And(
                                                                Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                                                Con.Direção = 'Direção de Conexão'.Input
                                                            ),
                                                            With(
                                                                LookUp(
                                                                    ConsCol As ColCon,
                                                                    ColCon.new_deviceioconnectionid = Con.'Device IO Connection'
                                                                ) As IndexedConInfo,
                                                                LookUp(
                                                                    'Device IO Connections' As RootCon,
                                                                    RootCon.'Device IO Connection' = IndexedConInfo.local_rootcon,
                                                                    RootCon.Device.Name & " - " & RootCon.Name & " | " & RootCon.Localização
                                                                )
                                                            ),
                                                            If(
                                                                And(
                                                                    Con.'Tipo de Conexão' = 'Tipo de Conexão'.Speaker,
                                                                    Con.Direção = 'Direção de Conexão'.Output,
                                                                    Con.'Device IO Connection' in Distinct(
                                                                        ConsCol As ColCon,
                                                                        ColCon.local_rootcon
                                                                    )
                                                                ),
                                                                With(
                                                                    {
                                                                        Value: Distinct(
                                                                            Filter(
                                                                                ConsCol As ColCon,
                                                                                ColCon.local_rootcon = Con.'Device IO Connection',
                                                                                ColCon.new_deviceioconnectionid <> Con.'Device IO Connection'
                                                                            )As Nei,
                                                                            Nei.new_deviceioconnectionid
                                                                        )
                                                                    } As NeighborConsIds,
                                                                    Concat(
                                                                        Filter(
                                                                            'Device IO Connections' As Con,
                                                                            Con.'Device IO Connection' in NeighborConsIds.Value
                                                                        ) As Con,
                                                                        Con.Device.Name,
                                                                        "+"
                                                                    )
                                                                ),
                                                                Con.'Connected To'.Device.Name & " - " & Con.'Connected To'.Name & " | " & Con.'Connected To'.Localização
                                                            )
                                                        )
                                                    ),
                                                    ",",
                                                    "."
                                                ) & "," & Substitute(
                                                    CurrentProjeto.Apelido,
                                                    ",",
                                                    "."
                                                )
                                            )
                                        ) As V,
                                        Len(V.Value) > 2
                                    ),
                                    Value,
                                    "
            "
                                )
                            ) As V,
                            Len(V.Value) > 2
                        ),
                        Value,
                        "
            "
                    ) & "
            ",
                    CSVEquipamentos: "Texto,Texto B,Nome do Projeto,Created On
            " & Concat(
                        Filter(
                            ForAll(
                                VisibleDevicesList As Dev,
                                Dev.Name & ",," & CurrentProjeto.Apelido
                            ) As V,
                            Len(V.Value) > 2
                        ),
                        Value,
                        "
            "
                    ) & "
            "
                }
            );
            UpdateContext({SpinCounter: SpinCounter - 1})
        Visible: =false
        Width: =96
        X: =180
        Y: =56
        ZIndex: =7

    PlotButton As Button:
        BasePaletteColor: =
        BorderColor: =
        DisplayMode: =DisplayMode.Edit
        FontColor: =
        Height: =32
        OnSelect: |-
            =UpdateContext({SpinCounter: SpinCounter + 1});
            With(
                {
                    nomeProjeto: Coalesce(
                        CurrentProjeto.Apelido,
                        " "
                    ),
                    produtos: With(
                        {
                            Value: Filter(
                                ConnectionsReport As Con,
                                Con.new_deviceid in Distinct(
                                    VisibleDevicesList As D,
                                    D.DeviceIO
                                )
                            )
                        } As InputDevices,
                        With(
                            {
                                Value: SortByColumns(
                                    AddColumns(
                                        InputDevices.Value As Cur,
                                        DeviceName,
                                        First(Cur.Connections).new_Device.Name,
                                        TipoDeSistema,
                                        With(
                                            {Value: GUID(Cur.new_deviceid)} As Id,
                                            LookUp(
                                                DeviceIOs As D,
                                                D.DeviceIO = Id.Value,
                                                D.'Modelo de Produto'.'Tipo de Sistema Padrão'
                                            )
                                        )
                                    ),
                                    "new_localizacao",
                                    SortOrder.Ascending,
                                    "TipoDeSistema",
                                    SortOrder.Ascending
                                )
                            } As Produtos,
                            ForAll(
                                Produtos.Value As P,
                                {
                                    nome: Coalesce(
                                        P.DeviceName,
                                        " "
                                    ),
                                    localizacao: Coalesce(
                                        P.new_localizacao,
                                        " "
                                    ),
                                    conexoes: ForAll(
                                        P.Connections As C,
                                        {
                                            origem: Coalesce(
                                                C.new_name,
                                                " "
                                            ),
                                            tipo: Coalesce(
                                                Text(C.new_tipodeconexao),
                                                " "
                                            ),
                                            direcao: Coalesce(
                                                Text(C.new_direcao),
                                                " "
                                            ),
                                            localDestino: Coalesce(
                                                C.ConnectedToLocation,
                                                " "
                                            ),
                                            dispositivoDestino: Coalesce(
                                                C.ConnectedToDeviceName,
                                                " "
                                            ),
                                            portaDestino: Coalesce(
                                                C.ConnectedToName,
                                                " "
                                            )
                                        }
                                    )
                                }
                            )
                        )
                    )
                } As Payload,
                With(
                    '(PDF)-PlotarGuiadeConexões'.Run(JSON(Payload)) As Response,
                    Download("https://0fe81aea6a5fe3278de31c56d9ac4e.ee.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/68800ad1aa084f27b94e613327e689de/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=eAes3l7eaI5YNZ17a1aJI6kX3XaED_ZVJWwysOm4gzk&downloadUri=" & Response.uri & "&filename=guia_" & Now() & ".pdf")
                );
                
            );
            UpdateContext({SpinCounter: SpinCounter - 1})
        Visible: =false
        Width: =96
        X: =47
        Y: =56
        ZIndex: =8

    PCFCopyTextComponent4 As PCFCopyTextComponent:
        DisplayMode: =DisplayMode.Edit
        Height: =Parent.Height
        OnChange: |-
            =UpdateContext({ShowDiagramText:false});
            Clear(FinalGraph);
            Launch("https://mermaid.live/edit",Blank(),LaunchTarget.New)
        Value: |-
            =Concat(FinalGraph,Value,"")
            /*If(
                Self.Visible = true,
                With(
                    {DeviceIO: RootDeviceId} As RootDevice,
                    With(
                        {
                            Value: SortByColumns(
                                Filter(
                                    VisibleDevicesList As D,
                                    D.Status = 'Status (Device IO)'.Active,
                                    D.Projeto.Projeto = CurrentProjeto.Projeto
                                ),
                                "new_localizacao",
                                SortOrder.Ascending
                            )
                        } As DeviceList,
                        With(
                            {
                                Value: With(
                                    {
                                        Value: SortByColumns(
                                            Filter(
                                                'Device IO Connections' As Con,
                                                Con.Status = 'Status (Device IO Connections)'.Active,
                                                Con.Device.Projeto.Projeto = CurrentProjeto.Projeto,
                                                !IsBlank(Con.'Connected To'),
                                                !IsBlank(Con.Device)
                                            ),
                                            "new_direcaorawtext",
                                            SortOrder.Ascending
                                        )
                                    } As CL,
                                    Filter(
                                        CL.Value As C,
                                        C.Device.DeviceIO in ForAll(
                                            DeviceList.Value As D,
                                            D.DeviceIO
                                        )
                                    )
                                )
                            } As ConList,
                            Concatenate(
                                "graph LR
                %% ====== Nós por ambiente ======
            ",
                                Concat(
                                    Distinct(
                                        DeviceList.Value As D,
                                        Proper(
                                            If(
                                                Len(TrimEnds(D.Localização)) = 0,
                                                "NãoIdentificado",
                                                D.Localização
                                            )
                                        )
                                    ) As Local,
                                    Concatenate(
                                        "    subgraph ",
                                        Substitute(
                                            Substitute(
                                                Substitute(
                                                    TrimEnds(Local.Value),
                                                    " ",
                                                    ""
                                                ),
                                                ")",
                                                ""
                                            ),
                                            "(",
                                            ""
                                        ),
                                        "
            ",
                                        Concat(
                                            ForAll(
                                                Filter(
                                                    DeviceList.Value As D,
                                                    Proper(D.Localização) = Local.Value
                                                ) As D,
                                                "        " & D.DeviceIO & "[" & """" & D.Name & """" & "]"
                                            ),
                                            Value,
                                            "
            "
                                        ),
                                        "
                end
            ",
                                        "
                style " & Substitute(
                                            Substitute(
                                                Substitute(
                                                    TrimEnds(Local.Value),
                                                    " ",
                                                    ""
                                                ),
                                                ")",
                                                ""
                                            ),
                                            "(",
                                            ""
                                        ) & " fill:#fff00,stroke:#333,stroke-width:2px
            "
                                    )
                                ),
                                "
                %% ====== Ligações (rótulos entre aspas; nada de colchetes) ======
                ",
                                With(
                                    {
                                        Value: Distinct(
                                            ConList.Value As Con,
                                            With(
                                                {
                                                    Value: Sort(
                                                        [
                                                            Con.'Device IO Connection',
                                                            Con.'Connected To'.'Device IO Connection'
                                                        ],
                                                        Value,
                                                        SortOrder.Ascending
                                                    )
                                                } As Combo,
                                                If(
                                                    LookUp(
                                                        ConList.Value As C,
                                                        C.'Device IO Connection' = Last(Combo.Value).Value
                                                    ).Device.DeviceIO = RootDevice.DeviceIO,
                                                    [
                                                        Last(Combo.Value).Value,
                                                        First(Combo.Value).Value
                                                    ],
                                                    [
                                                        First(Combo.Value).Value,
                                                        Last(Combo.Value).Value
                                                    ]
                                                )
                                            )
                                        )
                                    } As SelectedCons,
                                    Concat(
                                        SelectedCons.Value As Con,
                                        If(
                                            And(
                                                Len(
                                                    LookUp(
                                                        ConList.Value As C,
                                                        C.'Device IO Connection' = First(Con.Value).Value,
                                                        C.Device.DeviceIO
                                                    )
                                                ) > 0,
                                                Len(
                                                    LookUp(
                                                        ConList.Value As C,
                                                        C.'Device IO Connection' = Last(Con.Value).Value,
                                                        C.Device.DeviceIO
                                                    )
                                                ) > 0
                                            ),
                                            "
                " & LookUp(
                                                ConList.Value As C,
                                                C.'Device IO Connection' = First(Con.Value).Value,
                                                C.Device.DeviceIO
                                            ) & " -- """ & LookUp(
                                                ConList.Value As C,
                                                C.'Device IO Connection' = First(Con.Value).Value,
                                                C.Name
                                            ) & "
            →
            " & LookUp(
                                                ConList.Value As C,
                                                C.'Device IO Connection' = Last(Con.Value).Value,
                                                C.Name
                                            ) & """ --> " & LookUp(
                                                ConList.Value As C,
                                                C.'Device IO Connection' = Last(Con.Value).Value,
                                                C.Device.DeviceIO
                                            ),
                                            ""
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            )*/
        Visible: =ShowDiagramText
        Width: =Parent.Width
        X: =0
        Y: =0
        ZIndex: =9

    GenerateGraphButton As Button:
        BasePaletteColor: =
        BorderColor: =
        DisplayMode: =DisplayMode.Edit
        FontColor: =
        Height: =32
        OnSelect: |-
            =Clear(FinalGraph);
            Clear(_SavedCons);
            Clear(_ConQueue);
            Clear(_InsertedCons);
            Clear(_NodeDevicesIds);
            ForAll(
                VisibleDevicesList As Dev,
                ForAll(
                    Filter(
                        'Device IO Connections' As Con,
                        Con.Status = 'Status (Device IO Connections)'.Active,
                        Con.Device.DeviceIO = Dev.DeviceIO,
                        !IsBlank(Con.'Connected To'),
                        !IsBlank(Con.Device),
                        Or(
                            GroupByDropdownSelectedOption <> GroupByConTypeDropdownOption,
                            Con.'Tipo de Conexão' = SelectedDeviceTab.Option2
                        )
                    ) As Con,
                    Collect(
                        _NodeDevicesIds,
                        Con.Device.DeviceIO
                    );
                    Collect(
                        _NodeDevicesIds,
                        Con.'Connected To'.Device.DeviceIO
                    )
                )
            );
            ClearCollect(
                _NodeDevicesIds,
                Distinct(
                    _NodeDevicesIds,
                    Value
                )
            );
            With(
                {DeviceIO: RootDeviceId} As RootDevice,
                With(
                    {
                        Value: Sort(
                            SortByColumns(
                                Filter(
                                    'Device IO' As D,//VisibleDevicesList As D,
                                    D.Status = 'Status (Device IO)'.Active,
                                    D.Projeto.Projeto = CurrentProjeto.Projeto,
                                    D.DeviceIO in _NodeDevicesIds
                                ),
                                "new_localizacao",
                                SortOrder.Ascending,
                                "new_deviceioid",
                                SortOrder.Ascending
                            ) As D,
                            D.DeviceIO = RootDevice.DeviceIO,
                            SortOrder.Descending
                        )
                    } As DeviceList,
                    With(
                        {
                            Value: With(
                                {
                                    Value: SortByColumns(
                                        AddColumns(
                                            SortByColumns(
                                                Filter(
                                                    'Device IO Connections' As Con,
                                                    Con.Status = 'Status (Device IO Connections)'.Active,
                                                    Con.Device.Projeto.Projeto = CurrentProjeto.Projeto,
                                                    !IsBlank(Con.'Connected To'),
                                                    !IsBlank(Con.Device),
                                                    !IsBlank(Con.Device),
                                                    Or(
                                                        GroupByDropdownSelectedOption <> GroupByConTypeDropdownOption,
                                                        Con.'Tipo de Conexão' = SelectedDeviceTab.Option2
                                                    )
                                                ),
                                                "new_direcaorawtext",
                                                SortOrder.Ascending
                                            ) As C,
                                            Local,
                                            C.Device.Localização,
                                            DevId,
                                            C.Device.DeviceIO
                                        ),
                                        "Local",
                                        SortOrder.Ascending,
                                        "DevId",
                                        SortOrder.Ascending
                                    )
                                } As CL,
                                Filter(
                                    CL.Value As C,
                                    C.Device.DeviceIO in ForAll(
                                        VisibleDevicesList As D,
                                        D.DeviceIO
                                    )
                                )
                            )
                        } As ConList,
                        Collect(
                            FinalGraph,
                            "%%{init: {'flowchart': {'rankSpacing': 190, 'nodeSpacing':40, 'curve': 'linear','defaultRenderer': 'elk'}} }%%
            graph LR"
                        );
                        // Agrupar por localizações
            With(
                            {
                                Value: Sort(
                                    GroupBy(
                                        DeviceList.Value,
                                        Localização,
                                        Devices
                                    ) As L,
                                    L.new_localizacao = LookUp(
                                        DeviceList.Value As D,
                                        D.DeviceIO = RootDevice.DeviceIO,
                                        D.Localização
                                    ),
                                    SortOrder.Descending
                                )
                            } As Locations,
                                // Loop por cada localização
                            ForAll(
                                Locations.Value As Location,
                                Collect(
                                    FinalGraph,
                                    "
                subgraph " & Substitute(
                                        Substitute(
                                            Substitute(
                                                Substitute(
                                                    Substitute(
                                                        Coalesce(
                                                            TrimEnds(Location.new_localizacao),
                                                            "Sem Localização"
                                                        ),
                                                        "]",
                                                        ""
                                                    ),
                                                    "[",
                                                    ""
                                                ),
                                                ")",
                                                ""
                                            ),
                                            "(",
                                            ""
                                        ),
                                        " ",
                                        ""
                                    ) & "[""" & Substitute(
                                        Substitute(
                                            Coalesce(
                                                TrimEnds(Location.new_localizacao),
                                                "Sem Localização"
                                            ),
                                            "[",
                                            ""
                                        ),
                                        "]",
                                        ""
                                    ) & """]"
                                );
                                ForAll(
                                    Location.Devices As D,
                                    Collect(
                                        FinalGraph,
                                        "
                    " & D.DeviceIO & "[""" & Substitute(
                                            Substitute(
                                                D.Name,
                                                "[",
                                                ""
                                            ),
                                            "]",
                                            ""
                                        ) & """]"
                                    )
                                );
                                Collect(
                                    FinalGraph,
                                    "
                end"
                                );
                                Collect(
                                    FinalGraph,
                                    "
                "
                                );
                                ForAll(
                                    Filter(
                                        ConList.Value As Con,
                                        Con.DevId = RootDevice.DeviceIO
                                    ) As Con,
                                    If(
                                        IsBlank(
                                            LookUp(
                                                _SavedCons As SCon,
                                                Or(
                                                    And(
                                                        SCon.A = Con.DevId,
                                                        SCon.B = Con.'Connected To'.Device.DeviceIO
                                                    ),
                                                    And(
                                                        SCon.B = Con.DevId,
                                                        SCon.A = Con.'Connected To'.Device.DeviceIO
                                                    )
                                                )
                                            )
                                        ),
                                        Collect(
                                            FinalGraph,
                                            Con.DevId & " -- """ & Con.'Display Name' & "-" & Con.'Connected To'.Name & """ --- " & Con.'Connected To'.Device.DeviceIO & "; "
                                        );
                                        Collect(
                                            _SavedCons,
                                            {
                                                A: Con.DevId,
                                                B: Con.'Connected To'.Device.DeviceIO
                                            }
                                        );
                                        If(
                                            IsBlank(
                                                LookUp(
                                                    _ConQueue As Q,
                                                    Q.Value = Con.'Connected To'.Device.DeviceIO
                                                )
                                            ),
                                            Collect(
                                                _ConQueue,
                                                Con.'Connected To'.Device.DeviceIO
                                            )
                                        )
                                    )
                                );
                                ForAll(
                                    Location.Devices As D,
                                    Collect(
                                        FinalGraph,
                                        "
                "
                                    );
                                    With(
                                        {
                                            Value: Coalesce(
                                                First(
                                                    Filter(
                                                        _ConQueue As CQ,
                                                        Not(CQ.Value in _InsertedCons)
                                                    )
                                                ).Value,
                                                First(
                                                    Filter(
                                                        DeviceList.Value As Dev,
                                                        Not(Dev.DeviceIO in _InsertedCons),
                                                        Not(Dev.DeviceIO in _ConQueue)
                                                    )
                                                ).DeviceIO
                                            )
                                        } As CurDev,
                                        If(
                                            !IsBlank(CurDev.Value),
                                            ForAll(
                                                Filter(
                                                    ConList.Value As Con,
                                                    Con.DevId = CurDev.Value
                                                ) As Con,
                                                If(
                                                    IsBlank(
                                                        LookUp(
                                                            _SavedCons As SCon,
                                                            Or(
                                                                And(
                                                                    SCon.A = Con.DevId,
                                                                    SCon.B = Con.'Connected To'.Device.DeviceIO
                                                                ),
                                                                And(
                                                                    SCon.B = Con.DevId,
                                                                    SCon.A = Con.'Connected To'.Device.DeviceIO
                                                                )
                                                            )
                                                        )
                                                    ),
                                                    Collect(
                                                        FinalGraph,
                                                        Con.DevId & " -- """ & Con.'Display Name' & "-" & Con.'Connected To'.Name & """---" & Con.'Connected To'.Device.DeviceIO & "; "
                                                    );
                                                    Collect(
                                                        _SavedCons,
                                                        {
                                                            A: Con.DevId,
                                                            B: Con.'Connected To'.Device.DeviceIO
                                                        }
                                                    );
                                                    If(
                                                        IsBlank(
                                                            LookUp(
                                                                _ConQueue As Q,
                                                                Q.Value = Con.'Connected To'.Device.DeviceIO
                                                            )
                                                        ),
                                                        Collect(
                                                            _ConQueue,
                                                            Con.'Connected To'.Device.DeviceIO
                                                        )
                                                    )
                                                )
                                            );
                                            Collect(
                                                _InsertedCons,
                                                CurDev.Value
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
            Clear(_SavedCons);
            Clear(_ConQueue);
            Clear(_InsertedCons);
            Clear(_NodeDevicesIds)
        Visible: =false
        Width: =96
        X: =159
        Y: =56
        ZIndex: =10

