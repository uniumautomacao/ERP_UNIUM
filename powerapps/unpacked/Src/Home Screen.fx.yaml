"'Home Screen' As screen":
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |
        =If(
            IsBlank(SpinCounter),
            UpdateContext({SpinCounter: 0}),
            Select(RefreshButton)
        );

    RootLayoutContainer_HS As groupContainer.verticalAutoLayoutContainer:
        Fill: =RGBA(250, 250, 250, 1)
        Height: =App.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGridColumns: =6
        LayoutGridRows: =6
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        Width: =App.Width
        ZIndex: =1

        CommandContainer_HS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =44
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =3

            "CommandBar1 As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =200
                Items: |-
                    =Table(
                            {
                                ItemKey: "Refresh",
                                ItemIconName: "Refresh",
                                ItemDisplayName: "Atualizar"
                            },
                            {
                                ItemKey: "New",
                                ItemIconName: "Add",
                                ItemDisplayName: "Novo RMA"
                            }
                        )
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =200
                OnSelect: |-
                    =UpdateContext({SpinCounter: SpinCounter + 1});
                    Switch(
                        Self.Selected.ItemKey,
                        "Refresh",
                        Select(RefreshButton),
                        "New",
                        Launch(
                            "https://unium.crm2.dynamics.com/main.aspx?appid=3ec4d8a9-2a8e-ee11-8179-002248de6f66&forceUCI=1&pagetype=entityrecord&etn=new_rma&id=" & Patch(
                                Defaults(RMAS),
                                {
                                    new_posicao: Min(
                                        RMASAtivos As L,
                                        L.Posição
                                    ) - 1
                                }
                            ).RMA,
                            Blank(),
                            LaunchTarget.New
                        )
                    );
                    UpdateContext({SpinCounter: SpinCounter - 1})
                Theme: =AppThemeJson
                Width: =600 
                X: =0
                Y: =0
                ZIndex: =1

            RefreshButton As Button:
                BorderColor: =
                DisabledBorderColor: =
                DisabledFillColor: =
                DisabledTextColor: =
                DisplayMode: =DisplayMode.Edit
                FillColor: =
                Height: =32
                HoverBorderColor: =
                HoverFillColor: =
                HoverTextColor: =
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =96
                OnChange: =false
                OnSelect: |-
                    =UpdateContext({SpinCounter: SpinCounter + 1});
                    Concurrent(
                        Refresh(RMAS),
                        Refresh(AppPreferences)
                    );
                    With(
                        {
                            Value: Filter(
                                RMAS As L,
                                IsBlank(L.Posição)
                            )
                        } As PosicaoVazia,
                        ForAll(
                            PosicaoVazia.Value As Item,
                            Patch(
                                RMAS,
                                {
                                    RMA: Item.RMA,
                                    Posição: RandBetween(
                                        0,
                                        1000
                                    )
                                }
                            )
                        )
                    );
                    UpdateContext({SpinCounter: SpinCounter - 1})
                PressedBorderColor: =
                PressedFillColor: =
                PressedTextColor: =
                TextColor: =
                Visible: =false
                Width: =96
                X: =0
                Y: =0
                ZIndex: =2

            TextCanvas1 As Text:
                Align: ='TextCanvas.Align'.Center
                BorderColor: =
                DisplayMode: =DisplayMode.Edit
                Fill: =
                Font: =Font.Lato
                FontColor: =
                Height: =32
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =96
                Text: ="V2.8"
                VerticalAlign: =VerticalAlign.Middle
                Width: =96
                X: =0
                Y: =0
                ZIndex: =3

        SubheaderContainer_HS As groupContainer.horizontalAutoLayoutContainer:
            FillPortions: =0
            Height: =70
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutGap: =10
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =10
            PaddingRight: =10
            ZIndex: =4

            lbTitleCodeReview As label:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                Color: =RGBA(20, 0, 0, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =RGBA(166, 166, 166, 1)
                FillPortions: =1
                FocusedBorderThickness: =4
                Font: =Font.Lato
                FontWeight: =FontWeight.Semibold
                Height: =70
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                PaddingLeft: =20
                Text: ="Quadro de RMAs"
                Width: =240
                Y: =241
                ZIndex: =1

            ComboboxCanvas1 As Combobox.pcfdataset:
                DefaultSelectedItems: =EstagiosSelecionados
                DisplayMode: =DisplayMode.Edit
                Height: =32
                InputTextPlaceholder: ="Selecione os estágios desejados"
                Items: =Estagios
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: |-
                    =/*Patch(
                        AppPreferences,
                        Coalesce(
                            LookUp(
                                AppPreferences As P,
                                And(
                                    P.User.'Primary Email' = User().Email,
                                    P.'Preference Key' = "EstagioQuadroRMA_" & Self.Selected.Value
                                )
                            ),
                            Defaults(AppPreferences)
                        ),
                        {
                            'Preference Key': "EstagioQuadroRMA_" & Self.Selected.Value,
                            User: LookUp(
                                Users As U,
                                U.'Primary Email' = User().Email
                            ),
                            BoolValue: If(
                                LookUp(
                                    AppPreferences As P,
                                    And(
                                        P.User.'Primary Email' = User().Email,
                                        P.'Preference Key' = "EstagioQuadroRMA_" & Self.Selected.Value
                                    ),
                                    P.BoolValue
                                ) = true,
                                false,
                                true
                            )
                        }
                    );*/With(
                        {
                            Value: Filter(
                                AppPreferences As P,
                                P.User.'Primary Email' = User().Email,
                                StartsWith(
                                    P.'Preference Key',
                                    "EstagioQuadroRMA_"
                                )
                            )
                        } As Prefs,
                        Concurrent(
                            ForAll(
                                Self.SelectedItems As Item,
                                With(
                                    {Value: "EstagioQuadroRMA_" & Item.Value} As Key,
                                    If(
                                        CountRows(
                                            Filter(
                                                AppPreferences As P,
                                                P.User.'Primary Email' = User().Email,
                                                P.'Preference Key' = Key.Value
                                            )
                                        ) = 0,
                                        Patch(
                                            AppPreferences,
                                            Defaults(AppPreferences),
                                            {
                                                'Preference Key': Key.Value,
                                                User: LookUp(
                                                    Users As U,
                                                    U.'Primary Email' = User().Email
                                                ),
                                                BoolValue: true
                                            }
                                        )
                                    )
                                )
                            ),
                            ForAll(
                                Prefs.Value As P,
                                Patch(
                                    AppPreferences,
                                    P,
                                    {
                                        BoolValue: Last(
                                            Split(
                                                P.'Preference Key',
                                                "_"
                                            )
                                        ).Value in ForAll(
                                            Self.SelectedItems As I,
                                            Text(I.Value)
                                        )
                                    }
                                )
                            )
                        )
                    )
                SelectMultiple: =true
                Width: =320
                X: =0
                Y: =0
                ZIndex: =2

            SearchBox_1 As SearchBox:
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =640
                LayoutMinWidth: =640
                Styles: |-
                    =Table({Name: "PrimaryColor1Value", Value: "#ffffff"},
                    {Name: "PrimaryColor1TextValue", Value: "#292929"},
                    {Name: "PrimaryColor2Value", Value: "#0078d4"},
                    {Name: "PrimaryColor2TextValue", Value: "#ffffff"},
                    {Name: "PrimaryColor3Value", Value: "#303030"},
                    {Name: "PrimaryColor3TextValue", Value: "#080808"},
                    {Name: "PrimaryColor4Value", Value: "#006e7d"},
                    {Name: "defaultLabelColorValue", Value: "#333333"},
                    {Name: "RadiusValue", Value: "0"},
                    {Name: "TextBodyFontFaceValue", Value: "Segoe UI" },
                    {Name: "PaddingValue", Value: "8"},
                    {Name: "TextEmphasisFontSizeValue", Value: "16"},
                    {Name: "TextEmphasisFontSizePhoneValue", Value: "24"},
                    {Name: "TextBodyFontSizeValue", Value: "12"},
                    {Name: "TextBodyFontSizePhoneValue", Value: "21"},
                    {Name: "BackgroundColorValue", Value: "#ffffff"},
                    {Name: "BorderThicknessValue", Value: "0"},
                    {Name: "BorderColorValue", Value: "#FFFFFF"},
                    {Name: "FocusedBorderThicknessValue", Value: "0"},
                    {Name: "BackgroundColorValue", Value :"#FFFFFF"}
                    )
                ZIndex: =4

        ContentContainer_HS As groupContainer.verticalAutoLayoutContainer:
            LayoutGridColumns: =6
            LayoutGridRows: =6
            LayoutMaxHeight: =
            LayoutMaxWidth: =
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =5

            RMASGallery As gallery.BrowseLayout_Horizontal_TwoTextOneImageVariant_pcfCore:
                BorderColor: =RGBA(166, 166, 166, 1)
                DelayItemLoading: =true
                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                FocusedBorderThickness: =2
                Height: =365
                Items: |-
                    =/*AddColumns(
                        If(
                            CountRows(EstagiosSelecionados) = 0,
                            Estagios,
                            EstagiosSelecionados
                        ) As Item,
                        Items,
                        Filter(
                            RMASAtivos As L,
                            L.Situação = Item.Value
                        )
                    )*/
                    If(
                        CountRows(EstagiosSelecionados) = 0,
                        Estagios,
                        EstagiosSelecionados
                    )
                LayoutMaxHeight: =
                LayoutMaxWidth: =
                LayoutMinHeight: =182
                LayoutMinWidth: =0
                LoadingSpinner: =LoadingSpinner.Data
                TemplateSize: =LaneWidth
                ZIndex: =1

                Rectangle1 As rectangle:
                    BorderColor: =ColorValue(AppTheme.palette.neutralLight)
                    BorderThickness: =1
                    DisabledFill: =RGBA(0,0,0,0)
                    Fill: =RGBA(0,0,0,0)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =Parent.TemplateHeight
                    HoverFill: =RGBA(0,0,0,0)
                    OnSelect: =Select(Parent)
                    PressedFill: =RGBA(0,0,0,0)
                    TabIndex: =0
                    Visible: =false
                    Width: =Parent.TemplateWidth
                    ZIndex: =1

                RMASGalleryTemplate As groupContainer.verticalAutoLayoutContainer:
                    DropShadow: =DropShadow.Light
                    Height: =Parent.TemplateHeight
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGridColumns: =6
                    LayoutGridRows: =6
                    LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                    LayoutMode: =LayoutMode.Auto
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    Width: =Parent.TemplateWidth
                    ZIndex: =4

                    RMASGalleryTitleLabel As Label:
                        AcceptsFocus: =false
                        Alignment: =Align.Center
                        AutoHeight: =true
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        Font: =Font.Lato
                        FontSize: =10.5
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Italic: =false
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =32
                        OnChange: =false
                        OnSelect: =
                        Strikethrough: =false
                        TabIndex: =-1
                        Text: |-
                            =If(
                                IsBlank(ThisItem.Value),
                                "Novos",
                                ThisItem.Value
                            )
                        Underline: =false
                        VerticalAlignment: =VerticalAlign.Top
                        Width: =
                        X: =1
                        Y: =
                        ZIndex: =1

                    RMASGalleryResponsavelLabel As Label:
                        AcceptsFocus: =false
                        Alignment: =Align.Center
                        AutoHeight: =true
                        Color: =
                        ContentLanguage: =""
                        DisplayMode: =DisplayMode.Edit
                        Font: =Font.Lato
                        FontSize: =10.5
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Italic: =false
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =32
                        OnChange: =false
                        OnSelect: =
                        Overflow: ="Hidden"
                        PaddingBottom: =0
                        PaddingEnd: =0
                        PaddingStart: =0
                        PaddingTop: =0
                        Strikethrough: =false
                        TabIndex: =-1
                        Text: |-
                            =If(
                                ThisItem.Value in [
                                    'RMA Stage'.'Enviar para assistência',
                                    'RMA Stage'.'Em trânsito para assistência',
                                    'RMA Stage'.'Em análise',
                                    'RMA Stage'.'Em reparo',
                                    'RMA Stage'.'Em trânsito de retorno'
                                ],
                                "Adm",
                                If(
                                    ThisItem.Value in [
                                        'RMA Stage'.'Em avaliação interna',
                                        'RMA Stage'.'Recebido da assistência'
                                    ],
                                    "Estoquista",
                                    "CS"
                                )
                            )
                        TextRole: ="Default"
                        Tooltip: =""
                        Underline: =false
                        VerticalAlignment: =VerticalAlign.Top
                        Visible: =true
                        Width: =
                        Wrap: =true
                        X: =1
                        Y: =
                        ZIndex: =2

                    LaneSubtitleContainer As groupContainer.horizontalAutoLayoutContainer:
                        Fill: =RGBA(0,0,0,0)
                        FillPortions: =0
                        Height: =29
                        LayoutAlignItems: =LayoutAlignItems.Stretch
                        LayoutGridColumns: =6
                        LayoutGridRows: =6
                        LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =29
                        LayoutMinWidth: =0
                        LayoutMode: =LayoutMode.Auto
                        PaddingLeft: =10
                        PaddingRight: =10
                        ZIndex: =3

                        LaneCounterLabel As Label:
                            AcceptsFocus: =false
                            Alignment: =Align.Left
                            Color: =ColorValue(AppTheme.palette.neutralSecondary)
                            DisplayMode: =DisplayMode.Edit
                            FillPortions: =1
                            Font: =Font.Lato
                            Height: =32
                            Italic: =false
                            LayoutMaxHeight: =
                            LayoutMaxWidth: =
                            OnChange: =false
                            Strikethrough: =false
                            Text: |-
                                =With(
                                    {
                                        Value: CountRows(
                                            Filter(
                                                RMASAtivos As L,
                                                L.Situação = ThisItem.Value
                                            )
                                        )
                                    } As C,
                                    If(
                                        C.Value = 1,
                                        "1 negócio",
                                        C.Value & " itens"
                                    )
                                )
                            Underline: =false
                            Width: =
                            X: =0
                            Y: =0
                            ZIndex: =2

                    RMASLaneGallery As gallery.BrowseLayout_Flexible_NewsFeed_pcfCore:
                        BorderColor: =RGBA(166, 166, 166, 1)
                        DelayItemLoading: =true
                        FocusedBorderColor: =RGBA(0, 120, 212, 1)
                        FocusedBorderThickness: =2
                        Items: |-
                            =With(
                                {
                                    Value: Search(
                                        Filter(
                                            RMASAtivos As L,
                                            L.Situação = ThisItem.Value
                                        ),
                                        SearchBox_1.SearchText,
                                        'Assistência Técnica',
                                        Descrição,
                                        Observações,
                                        'Nome do Cliente (Fx)',
                                        'Projeto (Apelido) (Fx)',
                                        'Código de Rastreio da Transportadora',
                                        Observações
                                    )
                                } As Items,
                                If(
                                    ThisItem.Value = 'RMA Stage'.Devolvido,
                                    SortByColumns(
                                        FirstN(
                                            SortByColumns(
                                                Items.Value,
                                                "modifiedon",
                                                SortOrder.Descending
                                            ),
                                            50
                                        ),
                                        "new_lembreteexpirado",
                                        SortOrder.Descending,
                                        "new_posicao",
                                        SortOrder.Ascending
                                    ),
                                    Items.Value
                                )
                            )
                        Layout: =Layout.Vertical
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinHeight: =287
                        LayoutMinWidth: =320
                        LoadingSpinner: =LoadingSpinner.Data
                        OnSelect: =
                        TemplateSize: =100
                        ZIndex: =4

                        Separator1 As rectangle:
                            BorderColor: =RGBA(0, 0, 0, 0)
                            Fill: =ColorFade(RGBA(0, 120, 212, 1), -30%)
                            Height: =1
                            OnSelect: =Select(Parent)
                            Visible: =false
                            Width: =Parent.TemplateWidth
                            Y: =RMASLaneTemplateContainer.Y+RMASLaneTemplateContainer.Height
                            ZIndex: =1

                        RMASubtitleLabel_1 As label:
                            Align: =Align.Center
                            AutoHeight: =true
                            BorderColor: =RGBA(0, 0, 0, 0)
                            BorderStyle: =BorderStyle.None
                            BorderThickness: =2
                            Color: =RGBA(51, 51, 51, 1)
                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                            DisabledColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderThickness: =2
                            Font: =Font.Lato
                            Height: =
                            OnSelect: =
                            PaddingBottom: =0
                            PaddingLeft: =0
                            PaddingRight: =0
                            PaddingTop: =0
                            Size: =10.5
                            Text: ="R$ 0,00"
                            VerticalAlign: =VerticalAlign.Top
                            Width: =
                            X: =20
                            Y: =40
                            ZIndex: =2

                        RMASLaneTemplateRectangle As rectangle:
                            BorderColor: =RGBA(255, 0, 0, 1)
                            BorderStyle: =
                            BorderThickness: =1
                            DisabledFill: =RGBA(166, 166, 166, 1)
                            Fill: =RGBA(0, 0, 0, 0)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            Height: =RMASLaneTemplateContainer.Height
                            HoverFill: =RGBA(0, 0, 0, 0.1)
                            OnSelect: |
                                =Patch(
                                    AppPreferences,
                                    Defaults(AppPreferences),
                                    {
                                        User: CurrentUser,
                                        'Preference Key': "CadastroMercadoriaRMA_" & Now(),
                                        StringValue: ThisItem.RMA
                                    }
                                );
                                Launch(
                                    //"https://unium.crm2.dynamics.com/main.aspx?appid=3ec4d8a9-2a8e-ee11-8179-002248de6f66&forceUCI=1&pagetype=entityrecord&etn=new_rma&id=" & ThisItem.RMA,
                                    "https://unium.crm2.dynamics.com/main.aspx?appid=090088ff-5c8d-ee11-8179-002248de672c&pagetype=custom&name=new_cadastroderetornodemercadoriapage_754dc",//"https://unium.crm2.dynamics.com/main.aspx?pagetype=custom&name=new_cadastroderetornodemercadoriapage_754dc",
                                    Blank(),
                                    LaunchTarget.New
                                );
                            PressedFill: =RGBA(255, 255, 255, 0.1)
                            Width: =RMASLaneTemplateContainer.Width
                            ZIndex: =3

                        RMASLaneTemplateContainer As groupContainer.verticalAutoLayoutContainer:
                            BorderColor: =Color.Red
                            BorderStyle: |-
                                =If(
                                    Or(
                                        ThisItem.Sinalizar = true,
                                        And(
                                            ThisItem.'Data do Lembrete' < Now(),
                                            !IsBlank(ThisItem.'Data do Lembrete')
                                        )
                                    ),
                                    BorderStyle.Dotted,
                                    BorderStyle.None
                                )
                            BorderThickness: =1
                            DropShadow: =DropShadow.Semilight
                            Height: |-
                                =RMATitleLabel.Height + RMASubtitleContainer.Height + If(
                                    RMABodyLabel.Visible,
                                    RMABodyLabel.Height + Self.LayoutGap
                                ) + RMATitleLabel.Height + If(
                                    RMALembreteLabel.Visible,
                                    RMALembreteLabel.Height + Self.LayoutGap
                                ) + SituacaoContainer.Height + ClienteInformadoCheckbox.Height + Self.LayoutGap * 6
                            LayoutAlignItems: =LayoutAlignItems.Stretch
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutGap: =5
                            LayoutGridColumns: =6
                            LayoutGridRows: =6
                            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                            LayoutMode: =LayoutMode.Auto
                            PaddingBottom: =10
                            PaddingLeft: =10
                            PaddingRight: =10
                            PaddingTop: =10
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Width: =LaneWidth-Parent.TemplatePadding*2
                            ZIndex: =4

                            RMATitleLabel As label:
                                AutoHeight: =true
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =2
                                Font: =Font.Lato
                                FontWeight: =FontWeight.Semibold
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinHeight: =0
                                LayoutMinWidth: =0
                                OnSelect: =Select(RMASLaneTemplateRectangle)
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =10.5
                                Text: |-
                                    =ThisItem.Id & ": " & LookUp(
                                        RMAS As R,
                                        R.RMA = ThisItem.RMA,
                                        Coalesce(
                                            R.Cliente.'Full Name',
                                            R.'Ordem de Serviço'.'Projeto (Apelido)',
                                            R.'Ordem de Serviço'.'Nome do Cliente (Fx)',
                                            R.'Ordem de Serviço'.Name
                                        )
                                    )
                                VerticalAlign: =VerticalAlign.Top
                                Width: =
                                X: =12
                                Y: =6
                                ZIndex: =1

                            RMASubtitleContainer As groupContainer.horizontalAutoLayoutContainer:
                                FillPortions: =0
                                Height: =Max(InfoContainer.Height,40)
                                LayoutAlignItems: =LayoutAlignItems.Stretch
                                LayoutGridColumns: =6
                                LayoutGridRows: =6
                                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinHeight: =100
                                LayoutMinWidth: =0
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                ZIndex: =3

                                PosicaoContainer_1 As groupContainer.verticalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    FillPortions: =0
                                    Height: =40
                                    LayoutAlignItems: =LayoutAlignItems.End
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutGridColumns: =6
                                    LayoutGridRows: =6
                                    LayoutJustifyContent: =LayoutJustifyContent.Center
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =0
                                    LayoutMode: =LayoutMode.Auto
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Width: =30
                                    ZIndex: =1

                                    PosicaoUpButton_1 As Button:
                                        Appearance: ='ButtonCanvas.Appearance'.Transparent
                                        BasePaletteColor: =
                                        BorderColor: =
                                        DisplayMode: =DisplayMode.Edit
                                        FillPortions: =1
                                        FontColor: =
                                        Height: =32
                                        Icon: ="ChevronUp"
                                        Layout: ='ButtonCanvas.Layout'.IconOnly
                                        LayoutMaxHeight: =
                                        LayoutMaxWidth: =
                                        LayoutMinWidth: =96
                                        OnSelect: |-
                                            =// Definir a variável global para armazenar a lista atual ordenada corretamente
                                            UpdateContext({SpinCounter:SpinCounter+1});
                                            Set(
                                                colItensOrdenados,
                                                ShowColumns(
                                                    Filter(
                                                        RMASAtivos As L,
                                                        L.Situação = ThisItem.Situação
                                                    ),
                                                    Posição,
                                                    RMA
                                                )
                                            );
                                            // Encontrar o índice do item na lista ordenada
                                            Set(
                                                indexItem,
                                                LookUp(
                                                    ForAll(
                                                        Sequence(CountRows(colItensOrdenados)),
                                                        {
                                                            Index: Value,
                                                            ID: Last(
                                                                FirstN(
                                                                    colItensOrdenados,
                                                                    Value
                                                                )
                                                            ).new_rmaid
                                                        }
                                                    ),
                                                    ID = ThisItem.RMA
                                                ).Index
                                            );
                                            // Se o item estiver no topo, não faz nada
                                            If(
                                                indexItem = 1,
                                                Notify(
                                                    "Este item já está no topo.",
                                                    NotificationType.Warning
                                                ),
                                                With(
                                                    {
                                                        itemAtual: LookUp(
                                                            colItensOrdenados,
                                                            new_rmaid = ThisItem.RMA
                                                        ),
                                                        itemAnterior: Last(
                                                            FirstN(
                                                                colItensOrdenados,
                                                                indexItem - 1
                                                            )
                                                        )
                                                    },
                                                    Concurrent(
                                                        Patch(
                                                            RMAS,
                                                            itemAtual,
                                                            {Posição: itemAnterior.new_posicao}
                                                        ),
                                                        Patch(
                                                            RMAS,
                                                            itemAnterior,
                                                            {Posição: itemAtual.new_posicao}
                                                        )
                                                    )
                                                )
                                            );
                                            Select(RefreshButton);
                                            UpdateContext({SpinCounter:SpinCounter-1})
                                        Text: ="Up"
                                        Width: =40
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    PosicaoDownButton_1 As Button:
                                        Appearance: ='ButtonCanvas.Appearance'.Transparent
                                        BasePaletteColor: =
                                        BorderColor: =
                                        DisplayMode: =DisplayMode.Edit
                                        FillPortions: =1
                                        FontColor: =
                                        Height: =32
                                        Icon: ="ChevronDown"
                                        Layout: ='ButtonCanvas.Layout'.IconOnly
                                        LayoutMaxHeight: =
                                        LayoutMaxWidth: =
                                        LayoutMinWidth: =96
                                        OnSelect: |-
                                            =UpdateContext({SpinCounter:SpinCounter+1});
                                            // Definir a variável global para armazenar a lista atual ordenada corretamente
                                            Set(
                                                colItensOrdenados,
                                                ShowColumns(
                                                    Filter(
                                                        RMASAtivos As L,
                                                        L.Situação = ThisItem.Situação
                                                    ),
                                                    Posição,
                                                    RMA
                                                )
                                            );
                                            // Encontrar o índice do item na lista ordenada
                                            Set(
                                                indexItem,
                                                LookUp(
                                                    ForAll(
                                                        Sequence(CountRows(colItensOrdenados)),
                                                        {
                                                            Index: Value,
                                                            ID: Last(
                                                                FirstN(
                                                                    colItensOrdenados,
                                                                    Value
                                                                )
                                                            ).new_rmaid
                                                        }
                                                    ),
                                                    ID = ThisItem.RMA
                                                ).Index
                                            );
                                            // Se o item já estiver na última posição, não faz nada
                                            If(
                                                indexItem = CountRows(colItensOrdenados),
                                                Notify(
                                                    "Este item já está na última posição.",
                                                    NotificationType.Warning
                                                ),
                                                With(
                                                    {
                                                        itemAtual: LookUp(
                                                            colItensOrdenados,
                                                            new_rmaid = ThisItem.RMA
                                                        ),
                                                        itemProximo: Last(
                                                            FirstN(
                                                                colItensOrdenados,
                                                                indexItem + 1
                                                            )
                                                        )
                                                    },
                                                    Concurrent(
                                                        Patch(
                                                            RMAS,
                                                            itemAtual,
                                                            {Posição: itemProximo.new_posicao}
                                                        ),
                                                        Patch(
                                                            RMAS,
                                                            itemProximo,
                                                            {Posição: itemAtual.new_posicao}
                                                        )
                                                    )
                                                )
                                            );
                                            Select(RefreshButton);
                                            UpdateContext({SpinCounter:SpinCounter-1})
                                            /*
                                            Patch(RMAS,
                                                            itemAtual, 
                                                            { new_posicao: itemProximo.Posição }
                                                        );
                                                        Patch(RMAS,
                                                            itemProximo, 
                                                            { new_posicao: Items.itemAtual.Posição }
                                                        )
                                            */
                                        Text: ="Down"
                                        Width: =40
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                    ExpandButton As Button:
                                        Appearance: ='ButtonCanvas.Appearance'.Transparent
                                        BasePaletteColor: =
                                        BorderColor: =
                                        DisplayMode: =DisplayMode.Edit
                                        FillPortions: =1
                                        FontColor: =
                                        Height: =32
                                        Icon: ="Info"
                                        Layout: ='ButtonCanvas.Layout'.IconOnly
                                        LayoutMaxHeight: =
                                        LayoutMaxWidth: =
                                        LayoutMinWidth: =96
                                        OnSelect: |-
                                            =UpdateContext(
                                                {
                                                    ItemToExpand: If(
                                                        ItemToExpand = ThisItem.RMA,
                                                        Blank(),
                                                        ThisItem.RMA
                                                    )
                                                }
                                            )
                                        Text: ="Expand"
                                        Visible: |-
                                            =If(
                                                (Len(ThisItem.Descrição) + Len(ThisItem.Observações)) > 60,
                                                true,
                                                false
                                            )
                                        Width: =40
                                        X: =0
                                        Y: =0
                                        ZIndex: =3

                                InfoContainer As groupContainer.verticalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.Center
                                    Height: =If(RMAValueLabel.Visible,RMAValueLabel.Height)
                                    LayoutAlignItems: =LayoutAlignItems.Stretch
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutGridColumns: =6
                                    LayoutGridRows: =6
                                    LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =0
                                    LayoutMode: =LayoutMode.Auto
                                    LayoutWrap: =true
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    ZIndex: =4

                                    RMAValueLabel As label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        AutoHeight: =true
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(51, 51, 51, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FocusedBorderThickness: =2
                                        Font: =Font.Lato
                                        Height: =0
                                        LayoutMaxHeight: =
                                        LayoutMaxWidth: =
                                        LayoutMinWidth: =0
                                        OnSelect: =Select(RMASLaneTemplateRectangle)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        Size: =9
                                        Text: |-
                                            =With(
                                                {
                                                    Value: ThisItem.Descrição & If(
                                                        Len(TrimEnds(ThisItem.Observações)) > 0,
                                                        "
                                                
                                            " & ThisItem.Observações
                                                    )
                                                } As T,
                                                If(
                                                    Len(T.Value) <= 60,
                                                    T.Value,
                                                    If(
                                                        ItemToExpand = ThisItem.RMA,
                                                        T.Value,
                                                        Left(
                                                            T.Value,
                                                            60
                                                        ) & "..."
                                                    )
                                                )
                                            )
                                        VerticalAlign: =VerticalAlign.Top
                                        Width: =
                                        X: =12
                                        Y: =6
                                        ZIndex: =1

                            RMABodyLabel As label:
                                AutoHeight: =true
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =2
                                Font: =Font.Lato
                                FontWeight: =FontWeight.Lighter
                                Height: =
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinWidth: =0
                                OnSelect: =
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: |-
                                    =Concatenate(
                                        LookUp(
                                            RMAS As R,
                                            R.RMA = ThisItem.RMA,
                                            R.'Tipo de RMA'
                                        ),
                                        ": ",
                                        Concat(
                                            Distinct(
                                                Filter(
                                                    'Estoque-RMAS' As E,
                                                    E.'Estoque-RMA' in Distinct(
                                                        ThisItem.'Estoque-RMAS' As I,
                                                        I.'Estoque-RMA'
                                                    )
                                                ) As Item,
                                                Item.Produto.'Referência do Produto'
                                            ) As Item,
                                            Item.Value,
                                            ", "
                                        )
                                    )
                                VerticalAlign: =VerticalAlign.Top
                                Visible: =Len(Self.Text) > 0
                                Width: =
                                X: =12
                                Y: =6
                                ZIndex: =4

                            RMALembreteLabel As label:
                                AutoHeight: =true
                                BorderColor: =RGBA(0, 0, 0, 0)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                Color: =RGBA(51, 51, 51, 1)
                                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                DisabledColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =2
                                Font: =Font.Lato
                                FontWeight: =FontWeight.Lighter
                                Height: =
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinWidth: =0
                                OnSelect: =
                                PaddingBottom: =0
                                PaddingLeft: =0
                                PaddingRight: =0
                                PaddingTop: =0
                                Size: =8
                                Text: |-
                                    ="Data Lembrete: " & Text(ThisItem.'Data do Lembrete',DateTimeFormat.ShortDate,"pt-BR")
                                VerticalAlign: =VerticalAlign.Top
                                Visible: =!IsBlank(ThisItem.'Data do Lembrete')
                                Width: =
                                X: =12
                                Y: =6
                                ZIndex: =5

                            SituacaoContainer As groupContainer.verticalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.SetByContainer
                                FillPortions: =0
                                Height: =20
                                LayoutAlignItems: =LayoutAlignItems.Stretch
                                LayoutGridColumns: =6
                                LayoutGridRows: =6
                                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinHeight: =0
                                LayoutMinWidth: =0
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =30
                                ZIndex: =6

                                SituacaoLeftButton As Button:
                                    Appearance: ='ButtonCanvas.Appearance'.Transparent
                                    BasePaletteColor: =
                                    BorderColor: =
                                    DisplayMode: |-
                                        =If(
                                            Or(
                                                ThisItem.Situação = Blank(),
                                                ThisItem.Situação = Min(
                                                    Choices('RMA Stage') As S,
                                                    S.Value
                                                )
                                            ),
                                            DisplayMode.Disabled,
                                            DisplayMode.Edit
                                        )
                                    FillPortions: =1
                                    FontColor: =
                                    Height: =32
                                    Icon: ="ChevronLeft"
                                    Layout: ='ButtonCanvas.Layout'.IconOnly
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    OnSelect: |-
                                        =UpdateContext({SpinCounter: SpinCounter + 1});
                                        With(
                                            {
                                                Value: Filter(
                                                    Estagios As R,
                                                    R.Value < ThisItem.Situação
                                                )
                                            } As Estagios,
                                            With(
                                                LookUp(
                                                    Choices('RMA Stage') As S,
                                                    S.Value = Max(
                                                        Estagios.Value As E,
                                                        E.Value
                                                    )
                                                ) As EstagioAnterior,
                                                Patch(
                                                    RMAS,
                                                    {
                                                        RMA: ThisItem.RMA,
                                                        Situação: EstagioAnterior.Value
                                                    }
                                                )
                                            )
                                        );
                                        UpdateContext({SpinCounter: SpinCounter - 1})
                                    Text: ="Left"
                                    Width: =40
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                                PosicaoRightButton As Button:
                                    Appearance: ='ButtonCanvas.Appearance'.Transparent
                                    BasePaletteColor: =
                                    BorderColor: =
                                    DisplayMode: =If(ThisItem.Situação = Max(Choices('RMA Stage') As S, S.Value),DisplayMode.Disabled,DisplayMode.Edit)
                                    FillPortions: =1
                                    FontColor: =
                                    Height: =32
                                    Icon: ="ChevronRight"
                                    Layout: ='ButtonCanvas.Layout'.IconOnly
                                    LayoutMaxHeight: =
                                    LayoutMaxWidth: =
                                    OnSelect: |-
                                        =UpdateContext({SpinCounter: SpinCounter + 1});
                                        With(
                                            {
                                                Value: Filter(
                                                    Estagios As R,
                                                    R.Value > ThisItem.Situação
                                                )
                                            } As Estagios,
                                            With(
                                                LookUp(
                                                    Choices('RMA Stage') As S,
                                                    S.Value = Min(
                                                        Estagios.Value As E,
                                                        E.Value
                                                    )
                                                ) As ProximoEstagio,
                                                Patch(
                                                    RMAS,
                                                    {
                                                        RMA: ThisItem.RMA,
                                                        Situação: ProximoEstagio.Value
                                                    }
                                                )
                                            )
                                        );
                                        UpdateContext({SpinCounter: SpinCounter - 1})
                                    Text: ="Down"
                                    Width: =40
                                    X: =0
                                    Y: =0
                                    ZIndex: =2

                            ClienteInformadoCheckbox As Checkbox:
                                BasePaletteColor: =
                                Checked: |-
                                    =LookUp(
                                        RMAS As R,
                                        R.RMA = ThisItem.RMA,
                                        R.'Cliente Informado Sobre Estágio Atual'
                                    )
                                DisplayMode: =DisplayMode.Edit
                                FontColor: =
                                Height: =32
                                Label: ="Cliente Informado"
                                LayoutMaxHeight: =
                                LayoutMaxWidth: =
                                LayoutMinHeight: =32
                                LayoutMinWidth: =160
                                OnCheck: |-
                                    =Patch(
                                        RMAS,
                                        {
                                            RMA: ThisItem.RMA,
                                            'Último Estágio Informado ao Cliente': ThisItem.Situação
                                        }
                                    )
                                OnUncheck: |-
                                    =Patch(
                                        RMAS,
                                        {
                                            RMA: ThisItem.RMA,
                                            'Último Estágio Informado ao Cliente': Blank()
                                        }
                                    )
                                Width: =160
                                X: =0
                                Y: =0
                                ZIndex: =7

    "Spinner1 As 'Fluent Spinner (1.1.29) Preview'":
        BackgroundColor: |-
            ="#00000050"
        DisplayMode: =DisplayMode.Edit
        Height: =Parent.Height
        Label: ="Carregando..."
        SpinnerSize: ='PowerCAT.Spinner.SpinnerSize'.Large
        Theme: =AppThemeJson
        Visible: =SpinCounter > 0
        Width: =Parent.Width
        X: =0
        Y: =0
        ZIndex: =2

